<div class="left-side" id="myScrollspy">
    <ul class="nav nav-pills">
        <li><a href="#section1">支付系統</a></li>
        <li><a href="#section2">環境設定</a></li>
        <li><a href="#IAPInit">IAP 初始化</a></li>
        <li><a href="#Pay">支付</a></li>
        <li><a href="#GetOrder">查詢購買收據</a></li>
        <li><a href="#RestorePurchase">恢復購買</a></li>
    </ul>
</div>

<div class="right-side">
    <section id="section1">
        <h1>支付系統</h1>
        <p>與遊戲內購相關函式。</p>
    </section>

    <section id="section2">
        <h1>環境設定</h1>
        <p>要使用 Apple In-App Purchase 功能必須完成以下設定才能正常使用。</p>
        <br/>
        <h3>XCode 設定</h3>
        <hr>
        <ol>
            <li>在 navigator 區點選專案。</li>
            <li>在 editor 區點選 Capabilities。</li>
            <li>啟用 In-App Purchase。</li>
            <li>在要使用 IAP 的 .swift 檔案加入<code>import StoreKit</code>。</li>
        </ol>
        <div class="well well-sm">
            <img src=<%= "assets/img/" + lang + "/swiftpic05.png" %> class="img-responsive"/>
        </div>
    </section>

    <section id="IAPInit">
        <h1>IAP 初始化</h1>
        <span class="badge badge-ttl">函式</span>
        <p><pre>IAPInit(productIDs: [String]) -> Void</pre></p>

        <span class="badge badge-ttl">説明</span>
        <p>In-App Purchase 初始化之後才能開始購買。</p>

        <span class="badge badge-ttl">範例</span>
        <p>
            <% include ../code/swift-IAPInit.html %>
        </p>

        <span class="badge badge-ttl">參數</span>
        <p>productIDs 是在 iTunes Connect 設定的商品編號的字串陣列。</p>

        <span class="badge badge-ttl">回傳</span>
        <ul>
            <li>請參看【<a href="/swift-init#listener">回調監聽</a>】的設定，以及回傳的代碼與定義<a href="/webapi-init#section5">對照表</a>。</li>
            <li>回調監聽的 Data 參數：無。</li>
        </ul>
    </section>

    <section id="Pay">
        <h1>支付</h1>
        <span class="badge badge-ttl">函式</span>
        <p><pre>Pay(payRequest: SGPayRequest) -> Void</pre></p>

        <span class="badge badge-ttl">説明</span>
        <p>購買遊戲內付費商品時調用，向 app store 購買成功後會跟 SG Server 做驗證。</p>

        <span class="badge badge-ttl">範例</span>
        <p>
        <pre>SgSDK.Instance.Pay(payRequest: initPayReq(productId: productIDs[0], payMethod: "managed"))</pre>
        <% include ../code/swift-initPayReq.html %>
        </p>

        <span class="badge badge-ttl">參數</span>
        <p>
        <h3>SGPayRequest 結構</h3>
        <table id="SGPayRequest" class="table table-striped">
            <tr>
                <th>屬性</th>
                <th>必填</th>
                <th>描述</th>
            </tr>
            <tr>
                <td>ProductId</td>
                <td><i class="fa fa-check"></i></td>
                <td>產品代號</td>
            </tr>
            <tr>
                <td>ProductName</td>
                <td><i class="fa fa-check"></i></td>
                <td>產品名稱</td>
            </tr>
            <tr>
                <td>ProductDesc</td>
                <td></td>
                <td>產品描述</td>
            </tr>
            <tr>
                <td>PaymentMethod</td>
                <td></td>
                <td>產品種類 ex. Consumable, subscription</td>
            </tr>
            <tr>
                <td>PaymentChannel</td>
                <td></td>
                <td>
                    平台：<br/>
                    <span class="label label-primary">AppStore</span>
                </td>
            </tr>
            <tr>
                <td>Price</td>
                <td></td>
                <td>產品價格</td>
            </tr>
            <tr>
                <td>ServerId</td>
                <td></td>
                <td>伺服器代號</td>
            </tr>
            <tr>
                <td>ServerName</td>
                <td></td>
                <td>伺服器名稱</td>
            </tr>
            <tr>
                <td>RoleId</td>
                <td></td>
                <td>角色代號</td>
            </tr>
            <tr>
                <td>RoleName</td>
                <td></td>
                <td>角色名稱</td>
            </tr>
            <tr>
                <td>RoleLevel</td>
                <td></td>
                <td>角色等級</td>
            </tr>
            <tr>
                <td>PayNotifyUrl</td>
                <td></td>
                <td>驗證地址</td>
            </tr>
            <tr>
                <td>OrderId</td>
                <td></td>
                <td>訂單編號</td>
            </tr>
            <tr>
                <td>Receipt</td>
                <td></td>
                <td>App store 收據</td>
            </tr>
        </table>
        </p>

        <span class="badge badge-ttl">回傳</span>
        <ul>
            <li>請參看【<a href="/swift-init#listener">回調監聽</a>】的設定，以及回傳的代碼與定義<a href="/webapi-init#section5">對照表</a>。</li>
            <li>回調監聽的 Data 參數：<a href="#SGPayResponse">SGPayResponse</a>。</li>
        </ul>
        <h3>SGPayResponse 結構</h3>
        <table id="SGPayResponse" class="table table-striped">
            <tr>
                <th>屬性</th>
                <th>描述</th>
            </tr>
            <tr>
                <td>Code</td>
                <td>狀態代碼</td>
            </tr>
            <tr>
                <td>Msg</td>
                <td>狀態描述</td>
            </tr>
            <tr>
                <td>Sign</td>
                <td>由 SG Server 產生的簽名</td>
            </tr>
            <tr>
                <td>ProductId</td>
                <td>產品代號</td>
            </tr>
            <tr>
                <td>ProductName</td>
                <td>產品名稱</td>
            </tr>
            <tr>
                <td>ProductDesc</td>
                <td>產品描述</td>
            </tr>
            <tr>
                <td>PaymentMethod</td>
                <td>產品種類 ex. managed, subscription</td>
            </tr>
            <tr>
                <td>PaymentChannel</td>
                <td>平台 ex.AppStore</td>
            </tr>
            <tr>
                <td>Price</td>
                <td>產品價格</td>
            </tr>
            <tr>
                <td>ServerId</td>
                <td>伺服器代號</td>
            </tr>
            <tr>
                <td>ServerName</td>
                <td>伺服器名稱</td>
            </tr>
            <tr>
                <td>RoleId</td>
                <td>角色代號</td>
            </tr>
            <tr>
                <td>RoleName</td>
                <td>角色名稱</td>
            </tr>
            <tr>
                <td>RoleLevel</td>
                <td>角色等級</td>
            </tr>
            <tr>
                <td>PayNotifyUrl</td>
                <td>驗證地址</td>
            </tr>
            <tr>
                <td>OrderId</td>
                <td>訂單編號</td>
            </tr>
            <tr>
                <td>Receipt</td>
                <td>App store 收據</td>
            </tr>
        </table>
    </section>

    <section id="GetOrder">
        <h1>查詢購買收據</h1>
        <span class="badge badge-ttl">函式</span>
        <p><pre>GetOrder(orderId: String, gameKey: String, openId: Int, sign: String) -> Void</pre></p>

        <span class="badge badge-ttl">説明</span>
        <p>需傳送購買成功後的簽名(sign)，才能查詢訂單詳細內容。</p>

        <span class="badge badge-ttl">參數</span>
        <p>
        <table class="table table-striped">
            <tr>
                <th>參數名稱</th>
                <th>描述</th>
            </tr>
            <tr>
                <td>orderId</td>
                <td><a href="#SGPayResponse">SGPayResponse</a> 的屬性。</td>
            </tr>
            <tr>
                <td>gameKey</td>
                <td>Game key</td>
            </tr>
            <tr>
                <td>openId</td>
                <td>Login後可用 <a href="/swift-user#GetOpenID">GetOpenID()</a> 取得。</td>
            </tr>
            <tr>
                <td>sign</td>
                <td><a href="#SGPayResponse">SGPayResponse</a> 的屬性。</td>
            </tr>
        </table>
        </p>

        <span class="badge badge-ttl">回傳</span>
        <ul>
            <li>請參看【<a href="/swift-init#listener">回調監聽</a>】的設定，以及回傳的代碼與定義<a href="/webapi-init#section5">對照表</a>。</li>
            <li>回調監聽的 Data 參數：<a href="#SGPayResponse">SGPayResponse</a>。</li>
        </ul>
    </section>
    <br/>
    <section id="RestorePurchase">
        <h1>恢復購買</h1>
        <span class="badge badge-ttl">函式</span>
        <p><pre>RestorePurchase() -> Void</pre></p>

        <span class="badge badge-ttl">説明</span>
        <p>恢復購買，換手機時，只有在商品種類是 Non-Consumable, Auto-renewing subscription 這兩種商品會用到。</p>

        <span class="badge badge-ttl">回傳</span>
        <ul>
            <li>請參看【<a href="/swift-init#listener">回調監聽</a>】的設定，以及回傳的代碼與定義<a href="/webapi-init#section5">對照表</a>。</li>
            <li>回調監聽的 Data 參數：無。</li>
        </ul>
    </section>
</div>
<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">package</span> com<span style="color: #333333">.</span><span style="color: #0000CC">sg</span><span style="color: #333333">.</span><span style="color: #0000CC">util</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.json.JSONArray</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.json.JSONObject</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.annotation.TargetApi</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.content.Intent</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.os.Bundle</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.view.KeyEvent</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">com.unity3d.player.UnityPlayer</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">com.unity3d.player.UnityPlayerActivity</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">SGUtilUnityActivity</span> <span style="color: #008800; font-weight: bold">extends</span> UnityPlayerActivity <span style="color: #008800; font-weight: bold">implements</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">SGClient</span> <span style="color: #333333">{</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_GAMEOBJECT_NAME		<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;(sgutil_callback)&quot;</span><span style="color: #333333">;</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_STATE			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnState&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_INIT			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnInit&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_LOGIN			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnLogin&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_LOGOUT			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnLogout&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_PRODUCT			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnProduct&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_PAY				<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnPay&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_ORDERINFO			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnOrderInfo&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_ORDERSTATE			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnOrderState&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_DEBUGINFO			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnDebugInfo&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_TREASURE_LIST		<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnTreasureList&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_TREASURE			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnTreasure&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_REMOTE_LOG			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnRemoteLog&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_REMOTE_LOG_VALUE		<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnRemoteLogValue&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_START_GAME			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnStartGame&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_STOP_GAME			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnStopGame&quot;</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> String CALLBACK_EXTMETHOD			<span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;OnExtMethod&quot;</span><span style="color: #333333">;</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_OK				<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_NO_NEED				<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_FAIL				<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_CANCELLED			<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_ASYNC				<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_ITEM_BEGIN			<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">5</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_ITEM				<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">6</span><span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">final</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">int</span> RESULT_ITEM_END				<span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">7</span><span style="color: #333333">;</span>

	<span style="color: #008800; font-weight: bold">private</span> SGAgent agent<span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">private</span> String gameServerClassName<span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">boolean</span> autoDeliverProduct<span style="color: #333333">;</span>

	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">boolean</span> initCalled<span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">boolean</span> initOK<span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">boolean</span> agentInitialized<span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">int</span> agentInitializationResult<span style="color: #333333">;</span>
	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">boolean</span> initialized<span style="color: #333333">;</span>

	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">initUnityLib</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agentInitialized <span style="color: #333333">&amp;&amp;</span> initCalled<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(!</span>initialized<span style="color: #333333">)</span> <span style="color: #333333">{</span>
				initialized <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>gameServerClassName <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">!</span>gameServerClassName<span style="color: #333333">.</span><span style="color: #0000CC">trim</span><span style="color: #333333">().</span><span style="color: #0000CC">isEmpty</span><span style="color: #333333">())</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">try</span> <span style="color: #333333">{</span>
						Class clazz <span style="color: #333333">=</span> Class<span style="color: #333333">.</span><span style="color: #0000CC">forName</span><span style="color: #333333">(</span>gameServerClassName<span style="color: #333333">);</span>
						SGGameServerInterface gsvr <span style="color: #333333">=</span> <span style="color: #333333">(</span>SGGameServerInterface<span style="color: #333333">)</span> clazz<span style="color: #333333">.</span><span style="color: #0000CC">newInstance</span><span style="color: #333333">();</span>
						agent<span style="color: #333333">.</span><span style="color: #0000CC">setGameServer</span><span style="color: #333333">(</span>gsvr<span style="color: #333333">);</span>
					<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">catch</span> <span style="color: #333333">(</span>Exception e<span style="color: #333333">)</span> <span style="color: #333333">{</span>
						e<span style="color: #333333">.</span><span style="color: #0000CC">printStackTrace</span><span style="color: #333333">();</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(!</span>autoDeliverProduct<span style="color: #333333">)</span> <span style="color: #333333">{</span>
					agent<span style="color: #333333">.</span><span style="color: #0000CC">setOrderStateCheckingIntervals</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agentInitializationResult <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					initOK <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_INIT<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
				<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_INIT<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
			<span style="color: #333333">}</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">setSystemProperty</span><span style="color: #333333">(</span>String name<span style="color: #333333">,</span> String value<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		System<span style="color: #333333">.</span><span style="color: #0000CC">setProperty</span><span style="color: #333333">(</span>name<span style="color: #333333">,</span> value<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.Init</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">init</span><span style="color: #333333">(</span>String gameServerClassName<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">boolean</span> autoDeliverProduct<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(!</span>initCalled<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			initCalled <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">gameServerClassName</span> <span style="color: #333333">=</span> gameServerClassName<span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">.</span><span style="color: #0000CC">autoDeliverProduct</span> <span style="color: #333333">=</span> autoDeliverProduct<span style="color: #333333">;</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_INIT<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
			initUnityLib<span style="color: #333333">();</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_INIT<span style="color: #333333">,</span> RESULT_NO_NEED<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.Login</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">login</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>initOK <span style="color: #333333">&amp;&amp;</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">login</span><span style="color: #333333">())</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_LOGIN<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_LOGIN<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.Recover</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">recover</span><span style="color: #333333">(</span>String recoverToken<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>initOK <span style="color: #333333">&amp;&amp;</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">recover</span><span style="color: #333333">(</span>recoverToken<span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_LOGIN<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_LOGIN<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.Logout</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">logout</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">logout</span><span style="color: #333333">())</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_LOGOUT<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_LOGOUT<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.Exit</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">exit</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">boolean</span> silent<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>silent<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			finish<span style="color: #333333">();</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			agent<span style="color: #333333">.</span><span style="color: #0000CC">exit</span><span style="color: #333333">();</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.GetProductList</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">getProductList</span><span style="color: #333333">(</span>String filter<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">getProducts</span><span style="color: #333333">(</span>filter<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_PRODUCT<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_PRODUCT<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.Buy</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">buyProduct</span><span style="color: #333333">(</span>String productID<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> num<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">buyProduct</span><span style="color: #333333">(</span>productID<span style="color: #333333">,</span> num<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_PAY<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_PAY<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.GetOrderState</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">getOrderState</span><span style="color: #333333">(</span>String orderID<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">getOrderState</span><span style="color: #333333">(</span>orderID<span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERSTATE<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERSTATE<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// called by SGUInterfaceAndroid.GetOrderInfoList</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">getOrderInfoList</span><span style="color: #333333">(</span>String filter<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">getOrderInfoList</span><span style="color: #333333">(</span>filter<span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERINFO<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERINFO<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">getTreasureList</span><span style="color: #333333">(</span>String filter<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">getTreasureList</span><span style="color: #333333">())</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE_LIST<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE_LIST<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">incTreasure</span><span style="color: #333333">(</span>String name<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> value<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">incTreasure</span><span style="color: #333333">(</span>name<span style="color: #333333">,</span> value<span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">log</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> action<span style="color: #333333">,</span> String key<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> value<span style="color: #333333">,</span> String message<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>key <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">&amp;&amp;</span> key<span style="color: #333333">.</span><span style="color: #0000CC">trim</span><span style="color: #333333">().</span><span style="color: #0000CC">isEmpty</span><span style="color: #333333">())</span>
			key <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>message <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">&amp;&amp;</span> message<span style="color: #333333">.</span><span style="color: #0000CC">trim</span><span style="color: #333333">().</span><span style="color: #0000CC">isEmpty</span><span style="color: #333333">())</span>
			message <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">log</span><span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">char</span><span style="color: #333333">)</span>action<span style="color: #333333">,</span> key<span style="color: #333333">,</span> value<span style="color: #333333">,</span> message<span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_REMOTE_LOG<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_REMOTE_LOG<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">getLogValue</span><span style="color: #333333">(</span>String key<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> defaultValue<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">getLogValue</span><span style="color: #333333">(</span>key<span style="color: #333333">,</span> defaultValue<span style="color: #333333">))</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">startGame</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">startGame</span><span style="color: #333333">())</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_START_GAME<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_START_GAME<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">stopGame</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">stopGame</span><span style="color: #333333">())</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_STOP_GAME<span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_STOP_GAME<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> String <span style="color: #0066BB; font-weight: bold">getExtMethodList</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Code&quot;</span><span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
		JSONObject jdata <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectObject</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Data&quot;</span><span style="color: #333333">,</span> jdata<span style="color: #333333">);</span>
		JSONArray jarr <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONArray</span><span style="color: #333333">(</span>jdata<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Methods&quot;</span><span style="color: #333333">);</span>
		String s <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">runExtMethod</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;?&quot;</span><span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>s <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">&amp;&amp;</span> s<span style="color: #333333">.</span><span style="color: #0000CC">startsWith</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;*s&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
			String<span style="color: #333333">[]</span> ms <span style="color: #333333">=</span> s<span style="color: #333333">.</span><span style="color: #0000CC">substring</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">).</span><span style="color: #0000CC">split</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;\n&quot;</span><span style="color: #333333">);</span>
			<span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span>String m <span style="color: #333333">:</span> ms<span style="color: #333333">)</span> <span style="color: #333333">{</span>
				<span style="color: #333399; font-weight: bold">int</span> p <span style="color: #333333">=</span> m<span style="color: #333333">.</span><span style="color: #0000CC">lastIndexOf</span><span style="color: #333333">(</span><span style="color: #0044DD">&#39;=&#39;</span><span style="color: #333333">);</span>
				String prototype <span style="color: #333333">=</span> m<span style="color: #333333">.</span><span style="color: #0000CC">substring</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> p<span style="color: #333333">);</span>
				String name <span style="color: #333333">=</span> m<span style="color: #333333">.</span><span style="color: #0000CC">substring</span><span style="color: #333333">(</span>m<span style="color: #333333">.</span><span style="color: #0000CC">indexOf</span><span style="color: #333333">(</span><span style="color: #0044DD">&#39; &#39;</span><span style="color: #333333">)</span> <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> m<span style="color: #333333">.</span><span style="color: #0000CC">indexOf</span><span style="color: #333333">(</span><span style="color: #0044DD">&#39;(&#39;</span><span style="color: #333333">));</span>
				<span style="color: #333399; font-weight: bold">int</span> prop <span style="color: #333333">=</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>m<span style="color: #333333">.</span><span style="color: #0000CC">substring</span><span style="color: #333333">(</span>p <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">));</span>
				JSONObject jom <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jom<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Name&quot;</span><span style="color: #333333">,</span> name<span style="color: #333333">);</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jom<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Prototype&quot;</span><span style="color: #333333">,</span> prototype<span style="color: #333333">);</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jom<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Prop&quot;</span><span style="color: #333333">,</span> prop<span style="color: #333333">);</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONArrayObject</span><span style="color: #333333">(</span>jarr<span style="color: #333333">,</span> jom<span style="color: #333333">);</span>
			<span style="color: #333333">}</span>
		<span style="color: #333333">}</span>
		<span style="color: #008800; font-weight: bold">return</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">stringifyJSONObject</span><span style="color: #333333">(</span>jo<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">public</span> String <span style="color: #0066BB; font-weight: bold">runExtMethod</span><span style="color: #333333">(</span>String cookie<span style="color: #333333">,</span> String name<span style="color: #333333">,</span> String cmdLineArgs<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		StringBuilder sb <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> StringBuilder<span style="color: #333333">();</span>
		sb<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span>name<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>cookie <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
			sb<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span><span style="color: #0044DD">&#39; &#39;</span><span style="color: #333333">);</span>
			sb<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span>cookie<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>cmdLineArgs <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
			sb<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span><span style="color: #0044DD">&#39; &#39;</span><span style="color: #333333">);</span>
			sb<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span>cmdLineArgs<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
		String s <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">runExtMethod</span><span style="color: #333333">(</span>cookie<span style="color: #333333">,</span> sb<span style="color: #333333">.</span><span style="color: #0000CC">toString</span><span style="color: #333333">());</span>
		String p <span style="color: #333333">=</span> s<span style="color: #333333">.</span><span style="color: #0000CC">substring</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">);</span>
		s <span style="color: #333333">=</span> s<span style="color: #333333">.</span><span style="color: #0000CC">substring</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">);</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		JSONObject jdata <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jdata<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Cookie&quot;</span><span style="color: #333333">,</span> cookie <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">||</span> cookie<span style="color: #333333">.</span><span style="color: #0000CC">isEmpty</span><span style="color: #333333">()</span> <span style="color: #333333">?</span> name <span style="color: #333333">:</span> cookie<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>p<span style="color: #333333">.</span><span style="color: #0000CC">startsWith</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;!&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
			SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Code&quot;</span><span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>p<span style="color: #333333">.</span><span style="color: #0000CC">endsWith</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;v&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jdata<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Type&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Void&quot;</span><span style="color: #333333">);</span>
			<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>p<span style="color: #333333">.</span><span style="color: #0000CC">endsWith</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;n&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jdata<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Type&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Null&quot;</span><span style="color: #333333">);</span>
			<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jdata<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Type&quot;</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Text&quot;</span><span style="color: #333333">);</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jdata<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Text&quot;</span><span style="color: #333333">,</span> s<span style="color: #333333">);</span>
			<span style="color: #333333">}</span>
			<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>p<span style="color: #333333">.</span><span style="color: #0000CC">startsWith</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;@&quot;</span><span style="color: #333333">))</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Code&quot;</span><span style="color: #333333">,</span> RESULT_ASYNC<span style="color: #333333">);</span>
			<span style="color: #008800; font-weight: bold">else</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Code&quot;</span><span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectObject</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Data&quot;</span><span style="color: #333333">,</span> jdata<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">return</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">stringifyJSONObject</span><span style="color: #333333">(</span>jo<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #888888">// send callback to SGUCallback</span>
	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">sendCallback</span><span style="color: #333333">(</span>String callbackName<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> code<span style="color: #333333">,</span> JSONObject dataObj<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Code&quot;</span><span style="color: #333333">,</span> code<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>dataObj <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span>
			dataObj <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> JSONObject<span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectObject</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Data&quot;</span><span style="color: #333333">,</span> dataObj<span style="color: #333333">);</span>
		UnityPlayer<span style="color: #333333">.</span><span style="color: #0000CC">UnitySendMessage</span><span style="color: #333333">(</span>CALLBACK_GAMEOBJECT_NAME<span style="color: #333333">,</span> callbackName<span style="color: #333333">,</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">stringifyJSONObject</span><span style="color: #333333">(</span>jo<span style="color: #333333">));</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">sendCallback</span><span style="color: #333333">(</span>String callbackName<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> code<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		sendCallback<span style="color: #333333">(</span>callbackName<span style="color: #333333">,</span> code<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">private</span> JSONObject <span style="color: #0066BB; font-weight: bold">makeProductJSON</span><span style="color: #333333">(</span>UProduct product<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ProductID&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getProductID</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ProductName&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getProductName</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ProductDesc&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getProductDesc</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Price&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getPrice</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Coins&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getCoins</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;AppID&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getAppID</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;AppName&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getAppName</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ServerID&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getServerID</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ServerName&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getServerName</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;RoleID&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getRoleID</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;RoleName&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getRoleName</span><span style="color: #333333">());</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;RoleLevel&quot;</span><span style="color: #333333">,</span> product<span style="color: #333333">.</span><span style="color: #0000CC">getRoleLevel</span><span style="color: #333333">());</span>
		<span style="color: #008800; font-weight: bold">return</span> jo<span style="color: #333333">;</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onCreate</span><span style="color: #333333">(</span>Bundle savedInstanceState<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onCreate</span><span style="color: #333333">(</span>savedInstanceState<span style="color: #333333">);</span>
		agent <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> SGAgent<span style="color: #333333">();</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onCreate</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">this</span><span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onStart</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onStart</span><span style="color: #333333">();</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onStart</span><span style="color: #333333">();</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onRestart</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onRestart</span><span style="color: #333333">();</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onRestart</span><span style="color: #333333">();</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onResume</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onResume</span><span style="color: #333333">();</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onResume</span><span style="color: #333333">();</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onPause</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onPause</span><span style="color: #333333">();</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onPause</span><span style="color: #333333">();</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onStop</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onStop</span><span style="color: #333333">();</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onStop</span><span style="color: #333333">();</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onDestroy</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onDestroy</span><span style="color: #333333">();</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onDestroy</span><span style="color: #333333">();</span>
		System<span style="color: #333333">.</span><span style="color: #0000CC">exit</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onNewIntent</span><span style="color: #333333">(</span>Intent newIntent<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onNewIntent</span><span style="color: #333333">(</span>newIntent<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onNewIntent</span><span style="color: #333333">(</span>newIntent<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">onKeyDown</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> keyCode<span style="color: #333333">,</span> KeyEvent event<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>agent<span style="color: #333333">.</span><span style="color: #0000CC">onKeyDown</span><span style="color: #333333">(</span>keyCode<span style="color: #333333">,</span> event<span style="color: #333333">))</span>
			<span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
		<span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onKeyDown</span><span style="color: #333333">(</span>keyCode<span style="color: #333333">,</span> event<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onBackPressed</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onBackPressed</span><span style="color: #333333">();</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">protected</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onActivityResult</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> requestCode<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> resultCode<span style="color: #333333">,</span> Intent data<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onActivityResult</span><span style="color: #333333">(</span>requestCode<span style="color: #333333">,</span> resultCode<span style="color: #333333">,</span> data<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onActivityResult</span><span style="color: #333333">(</span>requestCode<span style="color: #333333">,</span> resultCode<span style="color: #333333">,</span> data<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@TargetApi</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">23</span><span style="color: #333333">)</span>
	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onRequestPermissionsResult</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> requestCode<span style="color: #333333">,</span> String<span style="color: #333333">[]</span> permissions<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">[]</span> grantResults<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">.</span><span style="color: #0000CC">onRequestPermissionsResult</span><span style="color: #333333">(</span>requestCode<span style="color: #333333">,</span> permissions<span style="color: #333333">,</span> grantResults<span style="color: #333333">);</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">onRequestPermissionsResult</span><span style="color: #333333">(</span>requestCode<span style="color: #333333">,</span> permissions<span style="color: #333333">,</span> grantResults<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onLog</span><span style="color: #333333">(</span>String text<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Message&quot;</span><span style="color: #333333">,</span> text<span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_DEBUGINFO<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onLog</span><span style="color: #333333">(</span>String text<span style="color: #333333">,</span> String postfix<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		onLog<span style="color: #333333">(</span>text <span style="color: #333333">+</span> <span style="color: #333333">(</span>postfix <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">?</span> postfix <span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;&quot;</span><span style="color: #333333">));</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">onProductBegin</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> num<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject data <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>data<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Count&quot;</span><span style="color: #333333">,</span> num<span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_PRODUCT<span style="color: #333333">,</span> RESULT_ITEM_BEGIN<span style="color: #333333">,</span> data<span style="color: #333333">);</span>
		<span style="color: #888888">// request for next product</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">wantProduct</span><span style="color: #333333">();</span>
		<span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onProductFound</span><span style="color: #333333">(</span>UProduct product<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>product <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_PRODUCT<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> makeProductJSON<span style="color: #333333">(</span>product<span style="color: #333333">));</span>
			<span style="color: #888888">// request for next product</span>
			agent<span style="color: #333333">.</span><span style="color: #0000CC">wantProduct</span><span style="color: #333333">();</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onProductEnd</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_PRODUCT<span style="color: #333333">,</span> RESULT_ITEM_END<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">onOrderInfoBegin</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> num<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject data <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>data<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Count&quot;</span><span style="color: #333333">,</span> num<span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERINFO<span style="color: #333333">,</span> RESULT_ITEM_BEGIN<span style="color: #333333">,</span> data<span style="color: #333333">);</span>
		<span style="color: #888888">// request for next order info</span>
		agent<span style="color: #333333">.</span><span style="color: #0000CC">wantOrderInfo</span><span style="color: #333333">();</span>
		<span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onOrderInfoFound</span><span style="color: #333333">(</span>UOrder order<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>order <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">&amp;&amp;</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getProduct</span><span style="color: #333333">()</span> <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
			JSONObject data <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
			SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>data<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ProductID&quot;</span><span style="color: #333333">,</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getProduct</span><span style="color: #333333">().</span><span style="color: #0000CC">getProductID</span><span style="color: #333333">());</span>
			SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>data<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Num&quot;</span><span style="color: #333333">,</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getPayParams</span><span style="color: #333333">().</span><span style="color: #0000CC">getBuyNum</span><span style="color: #333333">());</span>
			SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>data<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;OrderID&quot;</span><span style="color: #333333">,</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getOrderTicket</span><span style="color: #333333">().</span><span style="color: #0000CC">getOrderID</span><span style="color: #333333">());</span>
			SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>data<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;State&quot;</span><span style="color: #333333">,</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getState</span><span style="color: #333333">());</span>
			sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERINFO<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> data<span style="color: #333333">);</span>
			<span style="color: #888888">// request for next order info</span>
			agent<span style="color: #333333">.</span><span style="color: #0000CC">wantOrderInfo</span><span style="color: #333333">();</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onOrderInfoEnd</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERINFO<span style="color: #333333">,</span> RESULT_ITEM_END<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onTreasureListFound</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> treasures<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Count&quot;</span><span style="color: #333333">,</span> treasures<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE_LIST<span style="color: #333333">,</span> RESULT_ITEM_BEGIN<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span>String t <span style="color: #333333">:</span> treasures<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			String<span style="color: #333333">[]</span> kv <span style="color: #333333">=</span> t<span style="color: #333333">.</span><span style="color: #0000CC">split</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;=&quot;</span><span style="color: #333333">);</span>
			<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>kv<span style="color: #333333">.</span><span style="color: #0000CC">length</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
				jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Name&quot;</span><span style="color: #333333">,</span> kv<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">]);</span>
				SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Value&quot;</span><span style="color: #333333">,</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>kv<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">]));</span>
				sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE_LIST<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
			<span style="color: #333333">}</span>
		<span style="color: #333333">}</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE_LIST<span style="color: #333333">,</span> RESULT_ITEM_END<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onTreasureChange</span><span style="color: #333333">(</span>String name<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> value<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Name&quot;</span><span style="color: #333333">,</span> name<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Value&quot;</span><span style="color: #333333">,</span> value<span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onLogValue</span><span style="color: #333333">(</span>String key<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> value<span style="color: #333333">,</span> String msg<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Key&quot;</span><span style="color: #333333">,</span> key<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Value&quot;</span><span style="color: #333333">,</span> value<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Msg&quot;</span><span style="color: #333333">,</span> msg<span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onExtMethodNotification</span><span style="color: #333333">(</span>String cookie<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> code<span style="color: #333333">,</span> String msg<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Cookie&quot;</span><span style="color: #333333">,</span> cookie<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Code&quot;</span><span style="color: #333333">,</span> code<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>msg <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span>
			SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Message&quot;</span><span style="color: #333333">,</span> msg<span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_EXTMETHOD<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onOrderStateChange</span><span style="color: #333333">(</span>String productID<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> num<span style="color: #333333">,</span> String orderID<span style="color: #333333">,</span> String state<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ProductID&quot;</span><span style="color: #333333">,</span> productID<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Num&quot;</span><span style="color: #333333">,</span> num<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;OrderID&quot;</span><span style="color: #333333">,</span> orderID<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;State&quot;</span><span style="color: #333333">,</span> state<span style="color: #333333">);</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERSTATE<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onStateChange</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> type<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> orgState<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> newState<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> reason<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> op<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;State change: &quot;</span> <span style="color: #333333">+</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateName</span><span style="color: #333333">(</span>type<span style="color: #333333">,</span> orgState<span style="color: #333333">)</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; -&gt; &quot;</span> <span style="color: #333333">+</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateName</span><span style="color: #333333">(</span>type<span style="color: #333333">,</span> newState<span style="color: #333333">)</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; # &quot;</span> <span style="color: #333333">+</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateChangeReasonName</span><span style="color: #333333">(</span>reason<span style="color: #333333">)</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;\n&quot;</span><span style="color: #333333">);</span>
		JSONObject jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Type&quot;</span><span style="color: #333333">,</span> type<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;TypeName&quot;</span><span style="color: #333333">,</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateTypeName</span><span style="color: #333333">(</span>type<span style="color: #333333">));</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;OrgState&quot;</span><span style="color: #333333">,</span> orgState<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;OrgStateName&quot;</span><span style="color: #333333">,</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateName</span><span style="color: #333333">(</span>type<span style="color: #333333">,</span> orgState<span style="color: #333333">));</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;NewState&quot;</span><span style="color: #333333">,</span> newState<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;NewStateName&quot;</span><span style="color: #333333">,</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateName</span><span style="color: #333333">(</span>type<span style="color: #333333">,</span> newState<span style="color: #333333">));</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Reason&quot;</span><span style="color: #333333">,</span> reason<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;ReasonName&quot;</span><span style="color: #333333">,</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateChangeReasonName</span><span style="color: #333333">(</span>reason<span style="color: #333333">));</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectInt</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Op&quot;</span><span style="color: #333333">,</span> op<span style="color: #333333">);</span>
		SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;OpName&quot;</span><span style="color: #333333">,</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getOpName</span><span style="color: #333333">(</span>op<span style="color: #333333">));</span>
		sendCallback<span style="color: #333333">(</span>CALLBACK_STATE<span style="color: #333333">,</span> RESULT_ITEM<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
		<span style="color: #008800; font-weight: bold">switch</span> <span style="color: #333333">(</span>op<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_INIT</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">!=</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_INITIALIZING</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					agentInitialized <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
					agentInitializationResult <span style="color: #333333">=</span> reason<span style="color: #333333">;</span>
					initUnityLib<span style="color: #333333">();</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_LOGIN</span><span style="color: #333333">:</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_AUTH</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_INITIALIZED</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_LOGIN<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_LOGINGAME</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_INITIALIZED</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_LOGIN<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
				<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_LOGINEDGAME</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					String token <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getSession</span><span style="color: #333333">().</span><span style="color: #0000CC">getRecoverToken</span><span style="color: #333333">();</span>
					String username <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getSession</span><span style="color: #333333">().</span><span style="color: #0000CC">getUsername</span><span style="color: #333333">();</span>
					jo <span style="color: #333333">=</span> SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">createJSONObject</span><span style="color: #333333">();</span>
					SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;RecoverToken&quot;</span><span style="color: #333333">,</span> token<span style="color: #333333">);</span>
					SGJsonUtil<span style="color: #333333">.</span><span style="color: #0000CC">putJSONObjectString</span><span style="color: #333333">(</span>jo<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;Username&quot;</span><span style="color: #333333">,</span> username<span style="color: #333333">);</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_LOGIN<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">,</span> jo<span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_LOGOUTGAME</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_LOGINEDGAME</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_LOGOUT<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_LOGOUT</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_INITIALIZED</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_LOGOUT<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_GETORDER</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">PAYSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_PAY<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_PAY</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">PAYSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_PAY<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_CANCELED</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_PAY<span style="color: #333333">,</span> RESULT_CANCELLED<span style="color: #333333">);</span>
					<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_PAY<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">PAYSTATE_PAID</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					sendCallback<span style="color: #333333">(</span>CALLBACK_PAY<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_GETPRODUCTS</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_PRODUCT<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_GETORDERINFOLIST</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_ORDERINFO<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_GETTREASURELIST</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE_LIST<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_INCTREASURE</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_TREASURE<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_GETLOGVALUE</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_STARTGAME</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_START_GAME<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
					<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_START_GAME<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
			<span style="color: #008800; font-weight: bold">case</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">OP_STOPGAME</span><span style="color: #333333">:</span>
				<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>newState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>reason <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_STOP_GAME<span style="color: #333333">,</span> RESULT_OK<span style="color: #333333">);</span>
					<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
						sendCallback<span style="color: #333333">(</span>CALLBACK_STOP_GAME<span style="color: #333333">,</span> RESULT_FAIL<span style="color: #333333">);</span>
					<span style="color: #333333">}</span>
				<span style="color: #333333">}</span>
				<span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

<span style="color: #333333">}</span>
</pre></div>

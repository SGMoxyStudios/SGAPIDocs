<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">package</span> com<span style="color: #666666">.</span><span style="color: #7D9029">sg</span><span style="color: #666666">.</span><span style="color: #7D9029">util</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">org.json.JSONObject</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">android.annotation.TargetApi</span><span style="color: #666666">;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">android.content.Intent</span><span style="color: #666666">;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">android.os.Bundle</span><span style="color: #666666">;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">android.view.KeyEvent</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">com.unity3d.player.UnityPlayer</span><span style="color: #666666">;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">com.unity3d.player.UnityPlayerActivity</span><span style="color: #666666">;</span>

<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">SGUtilUnityActivity</span> <span style="color: #008000; font-weight: bold">extends</span> UnityPlayerActivity <span style="color: #008000; font-weight: bold">implements</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">SGClient</span> <span style="color: #666666">{</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_GAMEOBJECT_NAME     <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;(sgutil_callback)&quot;</span><span style="color: #666666">;</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_STATE               <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnState&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_INIT                <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnInit&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_LOGIN               <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnLogin&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_LOGOUT              <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnLogout&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_PRODUCT             <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnProduct&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_PAY                 <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnPay&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_ORDERINFO           <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnOrderInfo&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_ORDERSTATE          <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnOrderState&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_DEBUGINFO           <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnDebugInfo&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_TREASURE_LIST       <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnTreasureList&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_TREASURE            <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnTreasure&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_REMOTE_LOG          <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnRemoteLog&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_REMOTE_LOG_VALUE    <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnRemoteLogValue&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_START_GAME          <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnStartGame&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_STOP_GAME           <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnStopGame&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_EXTMETHOD_LIST      <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnExtMethodList&quot;</span><span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> String CALLBACK_EXTMETHOD           <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;OnExtMethod&quot;</span><span style="color: #666666">;</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_OK                       <span style="color: #666666">=</span> <span style="color: #666666">0;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_NO_NEED                  <span style="color: #666666">=</span> <span style="color: #666666">1;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_FAIL                     <span style="color: #666666">=</span> <span style="color: #666666">2;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_CANCELLED                <span style="color: #666666">=</span> <span style="color: #666666">3;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_ASYNC                    <span style="color: #666666">=</span> <span style="color: #666666">4;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_ITEM_BEGIN               <span style="color: #666666">=</span> <span style="color: #666666">5;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_ITEM                     <span style="color: #666666">=</span> <span style="color: #666666">6;</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> RESULT_ITEM_END                 <span style="color: #666666">=</span> <span style="color: #666666">7;</span>

    <span style="color: #008000; font-weight: bold">private</span> SGAgent agent<span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">private</span> String gameServerClassName<span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">boolean</span> autoDeliverProduct<span style="color: #666666">;</span>

    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">boolean</span> initCalled<span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">boolean</span> initOK<span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">boolean</span> agentInitialized<span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> agentInitializationResult<span style="color: #666666">;</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">boolean</span> initialized<span style="color: #666666">;</span>

    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">initUnityLib</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agentInitialized <span style="color: #666666">&amp;&amp;</span> initCalled<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(!</span>initialized<span style="color: #666666">)</span> <span style="color: #666666">{</span>
                initialized <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">;</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>gameServerClassName <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #666666">!</span>gameServerClassName<span style="color: #666666">.</span><span style="color: #7D9029">trim</span><span style="color: #666666">().</span><span style="color: #7D9029">isEmpty</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">try</span> <span style="color: #666666">{</span>
                        Class clazz <span style="color: #666666">=</span> Class<span style="color: #666666">.</span><span style="color: #7D9029">forName</span><span style="color: #666666">(</span>gameServerClassName<span style="color: #666666">);</span>
                        SGGameServerInterface gsvr <span style="color: #666666">=</span> <span style="color: #666666">(</span>SGGameServerInterface<span style="color: #666666">)</span> clazz<span style="color: #666666">.</span><span style="color: #7D9029">newInstance</span><span style="color: #666666">();</span>
                        agent<span style="color: #666666">.</span><span style="color: #7D9029">setGameServer</span><span style="color: #666666">(</span>gsvr<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">catch</span> <span style="color: #666666">(</span>Exception e<span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        e<span style="color: #666666">.</span><span style="color: #7D9029">printStackTrace</span><span style="color: #666666">();</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(!</span>autoDeliverProduct<span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    agent<span style="color: #666666">.</span><span style="color: #7D9029">setOrderStateCheckingIntervals</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agentInitializationResult <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    initOK <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">;</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_INIT<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">);</span>
                <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_INIT<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">setSystemProperty</span><span style="color: #666666">(</span>String name<span style="color: #666666">,</span> String value<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        System<span style="color: #666666">.</span><span style="color: #7D9029">setProperty</span><span style="color: #666666">(</span>name<span style="color: #666666">,</span> value<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.Init</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">init</span><span style="color: #666666">(</span>String gameServerClassName<span style="color: #666666">,</span> <span style="color: #B00040">boolean</span> autoDeliverProduct<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(!</span>initCalled<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            initCalled <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">this</span><span style="color: #666666">.</span><span style="color: #7D9029">gameServerClassName</span> <span style="color: #666666">=</span> gameServerClassName<span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">this</span><span style="color: #666666">.</span><span style="color: #7D9029">autoDeliverProduct</span> <span style="color: #666666">=</span> autoDeliverProduct<span style="color: #666666">;</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_INIT<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
            initUnityLib<span style="color: #666666">();</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_INIT<span style="color: #666666">,</span> RESULT_NO_NEED<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.Login</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">login</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>initOK <span style="color: #666666">&amp;&amp;</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">login</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_LOGIN<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_LOGIN<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.Recover</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">recover</span><span style="color: #666666">(</span>String recoverToken<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>initOK <span style="color: #666666">&amp;&amp;</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">recover</span><span style="color: #666666">(</span>recoverToken<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_LOGIN<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_LOGIN<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.Logout</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">logout</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">logout</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_LOGOUT<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_LOGOUT<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.Exit</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">exit</span><span style="color: #666666">(</span><span style="color: #B00040">boolean</span> silent<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>silent<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            finish<span style="color: #666666">();</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            agent<span style="color: #666666">.</span><span style="color: #7D9029">exit</span><span style="color: #666666">();</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.GetProductList</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">getProductList</span><span style="color: #666666">(</span>String filter<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">getProducts</span><span style="color: #666666">(</span>filter<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_PRODUCT<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_PRODUCT<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.Buy</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">buyProduct</span><span style="color: #666666">(</span>String productID<span style="color: #666666">,</span> <span style="color: #B00040">int</span> num<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">buyProduct</span><span style="color: #666666">(</span>productID<span style="color: #666666">,</span> num<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;&quot;</span><span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_PAY<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_PAY<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.GetOrderState</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">getOrderState</span><span style="color: #666666">(</span>String orderID<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">getOrderState</span><span style="color: #666666">(</span>orderID<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERSTATE<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERSTATE<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// called by SGUInterfaceAndroid.GetOrderInfoList</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">getOrderInfoList</span><span style="color: #666666">(</span>String filter<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">getOrderInfoList</span><span style="color: #666666">(</span>filter<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERINFO<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERINFO<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">getTreasureList</span><span style="color: #666666">(</span>String filter<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">getTreasureList</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE_LIST<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE_LIST<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">incTreasure</span><span style="color: #666666">(</span>String name<span style="color: #666666">,</span> <span style="color: #B00040">int</span> value<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">incTreasure</span><span style="color: #666666">(</span>name<span style="color: #666666">,</span> value<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">log</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> action<span style="color: #666666">,</span> String key<span style="color: #666666">,</span> <span style="color: #B00040">int</span> value<span style="color: #666666">,</span> String message<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>key <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> key<span style="color: #666666">.</span><span style="color: #7D9029">trim</span><span style="color: #666666">().</span><span style="color: #7D9029">isEmpty</span><span style="color: #666666">())</span>
            key <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">;</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>message <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> message<span style="color: #666666">.</span><span style="color: #7D9029">trim</span><span style="color: #666666">().</span><span style="color: #7D9029">isEmpty</span><span style="color: #666666">())</span>
            message <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">;</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">log</span><span style="color: #666666">((</span><span style="color: #B00040">char</span><span style="color: #666666">)</span>action<span style="color: #666666">,</span> key<span style="color: #666666">,</span> value<span style="color: #666666">,</span> message<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_REMOTE_LOG<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_REMOTE_LOG<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">getLogValue</span><span style="color: #666666">(</span>String key<span style="color: #666666">,</span> <span style="color: #B00040">int</span> defaultValue<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">getLogValue</span><span style="color: #666666">(</span>key<span style="color: #666666">,</span> defaultValue<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">startGame</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">startGame</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_START_GAME<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_START_GAME<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">stopGame</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">stopGame</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_STOP_GAME<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_STOP_GAME<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">getExtMethodList</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        String s <span style="color: #666666">=</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">runExtMethod</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;?&quot;</span><span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>s <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> s<span style="color: #666666">.</span><span style="color: #7D9029">startsWith</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;*s&quot;</span><span style="color: #666666">))</span> <span style="color: #666666">{</span>
            String<span style="color: #666666">[]</span> ms <span style="color: #666666">=</span> s<span style="color: #666666">.</span><span style="color: #7D9029">substring</span><span style="color: #666666">(2).</span><span style="color: #7D9029">split</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;\n&quot;</span><span style="color: #666666">);</span>
            JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
            SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Count&quot;</span><span style="color: #666666">,</span> ms<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">);</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_EXTMETHOD_LIST<span style="color: #666666">,</span> RESULT_ITEM_BEGIN<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
            <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>String m <span style="color: #666666">:</span> ms<span style="color: #666666">)</span> <span style="color: #666666">{</span>
                <span style="color: #B00040">int</span> p <span style="color: #666666">=</span> m<span style="color: #666666">.</span><span style="color: #7D9029">lastIndexOf</span><span style="color: #666666">(</span><span style="color: #BA2121">&#39;=&#39;</span><span style="color: #666666">);</span>
                String prototype <span style="color: #666666">=</span> m<span style="color: #666666">.</span><span style="color: #7D9029">substring</span><span style="color: #666666">(0,</span> p<span style="color: #666666">);</span>
                String name <span style="color: #666666">=</span> m<span style="color: #666666">.</span><span style="color: #7D9029">substring</span><span style="color: #666666">(</span>m<span style="color: #666666">.</span><span style="color: #7D9029">indexOf</span><span style="color: #666666">(</span><span style="color: #BA2121">&#39; &#39;</span><span style="color: #666666">)</span> <span style="color: #666666">+</span> <span style="color: #666666">1,</span> m<span style="color: #666666">.</span><span style="color: #7D9029">indexOf</span><span style="color: #666666">(</span><span style="color: #BA2121">&#39;(&#39;</span><span style="color: #666666">));</span>
                <span style="color: #B00040">int</span> prop <span style="color: #666666">=</span> Integer<span style="color: #666666">.</span><span style="color: #7D9029">parseInt</span><span style="color: #666666">(</span>m<span style="color: #666666">.</span><span style="color: #7D9029">substring</span><span style="color: #666666">(</span>p <span style="color: #666666">+</span> <span style="color: #666666">1));</span>
                jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Name&quot;</span><span style="color: #666666">,</span> name<span style="color: #666666">);</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Prototype&quot;</span><span style="color: #666666">,</span> prototype<span style="color: #666666">);</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Prop&quot;</span><span style="color: #666666">,</span> prop<span style="color: #666666">);</span>
                sendCallback<span style="color: #666666">(</span>CALLBACK_EXTMETHOD_LIST<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
            <span style="color: #666666">}</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_EXTMETHOD_LIST<span style="color: #666666">,</span> RESULT_ITEM_END<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_EXTMETHOD_LIST<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">runExtMethod</span><span style="color: #666666">(</span>String cookie<span style="color: #666666">,</span> String name<span style="color: #666666">,</span> String cmdLineArgs<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        StringBuilder sb <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> StringBuilder<span style="color: #666666">();</span>
        sb<span style="color: #666666">.</span><span style="color: #7D9029">append</span><span style="color: #666666">(</span>name<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>cookie <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
            sb<span style="color: #666666">.</span><span style="color: #7D9029">append</span><span style="color: #666666">(</span><span style="color: #BA2121">&#39; &#39;</span><span style="color: #666666">);</span>
            sb<span style="color: #666666">.</span><span style="color: #7D9029">append</span><span style="color: #666666">(</span>cookie<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>cmdLineArgs <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
            sb<span style="color: #666666">.</span><span style="color: #7D9029">append</span><span style="color: #666666">(</span><span style="color: #BA2121">&#39; &#39;</span><span style="color: #666666">);</span>
            sb<span style="color: #666666">.</span><span style="color: #7D9029">append</span><span style="color: #666666">(</span>cmdLineArgs<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
        String s <span style="color: #666666">=</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">runExtMethod</span><span style="color: #666666">(</span>sb<span style="color: #666666">.</span><span style="color: #7D9029">toString</span><span style="color: #666666">());</span>
        String p <span style="color: #666666">=</span> s<span style="color: #666666">.</span><span style="color: #7D9029">substring</span><span style="color: #666666">(0,</span> <span style="color: #666666">2);</span>
        s <span style="color: #666666">=</span> s<span style="color: #666666">.</span><span style="color: #7D9029">substring</span><span style="color: #666666">(2);</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>p<span style="color: #666666">.</span><span style="color: #7D9029">startsWith</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;!&quot;</span><span style="color: #666666">))</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_EXTMETHOD<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>p<span style="color: #666666">.</span><span style="color: #7D9029">endsWith</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;v&quot;</span><span style="color: #666666">))</span> <span style="color: #666666">{</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Type&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Void&quot;</span><span style="color: #666666">);</span>
            <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>p<span style="color: #666666">.</span><span style="color: #7D9029">endsWith</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;n&quot;</span><span style="color: #666666">))</span> <span style="color: #666666">{</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Type&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Null&quot;</span><span style="color: #666666">);</span>
            <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Type&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Text&quot;</span><span style="color: #666666">);</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Text&quot;</span><span style="color: #666666">,</span> s<span style="color: #666666">);</span>
            <span style="color: #666666">}</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>p<span style="color: #666666">.</span><span style="color: #7D9029">startsWith</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;@&quot;</span><span style="color: #666666">))</span>
                sendCallback<span style="color: #666666">(</span>CALLBACK_EXTMETHOD<span style="color: #666666">,</span> RESULT_ASYNC<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
            <span style="color: #008000; font-weight: bold">else</span>
                <span style="color: #0000FF">sendCallback</span><span style="color: #666666">(</span>CALLBACK_EXTMETHOD<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">// send callback to SGUCallback</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">sendCallback</span><span style="color: #666666">(</span>String callbackName<span style="color: #666666">,</span> <span style="color: #B00040">int</span> code<span style="color: #666666">,</span> JSONObject dataObj<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Code&quot;</span><span style="color: #666666">,</span> code<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>dataObj <span style="color: #666666">==</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span>
            dataObj <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> JSONObject<span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectObject</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Data&quot;</span><span style="color: #666666">,</span> dataObj<span style="color: #666666">);</span>
        UnityPlayer<span style="color: #666666">.</span><span style="color: #7D9029">UnitySendMessage</span><span style="color: #666666">(</span>CALLBACK_GAMEOBJECT_NAME<span style="color: #666666">,</span> callbackName<span style="color: #666666">,</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">stringifyJSONObject</span><span style="color: #666666">(</span>jo<span style="color: #666666">));</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">sendCallback</span><span style="color: #666666">(</span>String callbackName<span style="color: #666666">,</span> <span style="color: #B00040">int</span> code<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        sendCallback<span style="color: #666666">(</span>callbackName<span style="color: #666666">,</span> code<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #008000; font-weight: bold">private</span> JSONObject <span style="color: #0000FF">makeProductJSON</span><span style="color: #666666">(</span>UProduct product<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ProductID&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getProductID</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ProductName&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getProductName</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ProductDesc&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getProductDesc</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Price&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getPrice</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Coins&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getCoins</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;AppID&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getAppID</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;AppName&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getAppName</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ServerID&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getServerID</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ServerName&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getServerName</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;RoleID&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getRoleID</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;RoleName&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getRoleName</span><span style="color: #666666">());</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;RoleLevel&quot;</span><span style="color: #666666">,</span> product<span style="color: #666666">.</span><span style="color: #7D9029">getRoleLevel</span><span style="color: #666666">());</span>
        <span style="color: #008000; font-weight: bold">return</span> jo<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onCreate</span><span style="color: #666666">(</span>Bundle savedInstanceState<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onCreate</span><span style="color: #666666">(</span>savedInstanceState<span style="color: #666666">);</span>
        agent <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> SGAgent<span style="color: #666666">();</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onCreate</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">this</span><span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">this</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onStart</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onStart</span><span style="color: #666666">();</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onStart</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onRestart</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onRestart</span><span style="color: #666666">();</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onRestart</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onResume</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onResume</span><span style="color: #666666">();</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onResume</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onPause</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onPause</span><span style="color: #666666">();</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onPause</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onStop</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onStop</span><span style="color: #666666">();</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onStop</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onDestroy</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onDestroy</span><span style="color: #666666">();</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onDestroy</span><span style="color: #666666">();</span>
        System<span style="color: #666666">.</span><span style="color: #7D9029">exit</span><span style="color: #666666">(0);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onNewIntent</span><span style="color: #666666">(</span>Intent newIntent<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onNewIntent</span><span style="color: #666666">(</span>newIntent<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onNewIntent</span><span style="color: #666666">(</span>newIntent<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">boolean</span> <span style="color: #0000FF">onKeyDown</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> keyCode<span style="color: #666666">,</span> KeyEvent event<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>agent<span style="color: #666666">.</span><span style="color: #7D9029">onKeyDown</span><span style="color: #666666">(</span>keyCode<span style="color: #666666">,</span> event<span style="color: #666666">))</span>
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">;</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onKeyDown</span><span style="color: #666666">(</span>keyCode<span style="color: #666666">,</span> event<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onBackPressed</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onBackPressed</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onActivityResult</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> requestCode<span style="color: #666666">,</span> <span style="color: #B00040">int</span> resultCode<span style="color: #666666">,</span> Intent data<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onActivityResult</span><span style="color: #666666">(</span>requestCode<span style="color: #666666">,</span> resultCode<span style="color: #666666">,</span> data<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onActivityResult</span><span style="color: #666666">(</span>requestCode<span style="color: #666666">,</span> resultCode<span style="color: #666666">,</span> data<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@TargetApi</span><span style="color: #666666">(23)</span>
    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onRequestPermissionsResult</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> requestCode<span style="color: #666666">,</span> String<span style="color: #666666">[]</span> permissions<span style="color: #666666">,</span> <span style="color: #B00040">int</span><span style="color: #666666">[]</span> grantResults<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">.</span><span style="color: #7D9029">onRequestPermissionsResult</span><span style="color: #666666">(</span>requestCode<span style="color: #666666">,</span> permissions<span style="color: #666666">,</span> grantResults<span style="color: #666666">);</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">onRequestPermissionsResult</span><span style="color: #666666">(</span>requestCode<span style="color: #666666">,</span> permissions<span style="color: #666666">,</span> grantResults<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onLog</span><span style="color: #666666">(</span>String text<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Message&quot;</span><span style="color: #666666">,</span> text<span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_DEBUGINFO<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onLog</span><span style="color: #666666">(</span>String text<span style="color: #666666">,</span> String postfix<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        onLog<span style="color: #666666">(</span>text <span style="color: #666666">+</span> <span style="color: #666666">(</span>postfix <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">?</span> postfix <span style="color: #666666">:</span> <span style="color: #BA2121">&quot;&quot;</span><span style="color: #666666">));</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">boolean</span> <span style="color: #0000FF">onProductBegin</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> num<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject data <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>data<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Count&quot;</span><span style="color: #666666">,</span> num<span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_PRODUCT<span style="color: #666666">,</span> RESULT_ITEM_BEGIN<span style="color: #666666">,</span> data<span style="color: #666666">);</span>
        <span style="color: #408080; font-style: italic">// request for next product</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">wantProduct</span><span style="color: #666666">();</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">false</span><span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onProductFound</span><span style="color: #666666">(</span>UProduct product<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>product <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_PRODUCT<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> makeProductJSON<span style="color: #666666">(</span>product<span style="color: #666666">));</span>
            <span style="color: #408080; font-style: italic">// request for next product</span>
            agent<span style="color: #666666">.</span><span style="color: #7D9029">wantProduct</span><span style="color: #666666">();</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onProductEnd</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_PRODUCT<span style="color: #666666">,</span> RESULT_ITEM_END<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">boolean</span> <span style="color: #0000FF">onOrderInfoBegin</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> num<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject data <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>data<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Count&quot;</span><span style="color: #666666">,</span> num<span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERINFO<span style="color: #666666">,</span> RESULT_ITEM_BEGIN<span style="color: #666666">,</span> data<span style="color: #666666">);</span>
        <span style="color: #408080; font-style: italic">// request for next order info</span>
        agent<span style="color: #666666">.</span><span style="color: #7D9029">wantOrderInfo</span><span style="color: #666666">();</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">false</span><span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onOrderInfoFound</span><span style="color: #666666">(</span>UOrder order<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>order <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span> <span style="color: #666666">&amp;&amp;</span> order<span style="color: #666666">.</span><span style="color: #7D9029">getProduct</span><span style="color: #666666">()</span> <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
            JSONObject data <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
            SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>data<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ProductID&quot;</span><span style="color: #666666">,</span> order<span style="color: #666666">.</span><span style="color: #7D9029">getProduct</span><span style="color: #666666">().</span><span style="color: #7D9029">getProductID</span><span style="color: #666666">());</span>
            SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>data<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Num&quot;</span><span style="color: #666666">,</span> order<span style="color: #666666">.</span><span style="color: #7D9029">getPayParams</span><span style="color: #666666">().</span><span style="color: #7D9029">getBuyNum</span><span style="color: #666666">());</span>
            SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>data<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;OrderID&quot;</span><span style="color: #666666">,</span> order<span style="color: #666666">.</span><span style="color: #7D9029">getOrderTicket</span><span style="color: #666666">().</span><span style="color: #7D9029">getOrderID</span><span style="color: #666666">());</span>
            SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>data<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;State&quot;</span><span style="color: #666666">,</span> order<span style="color: #666666">.</span><span style="color: #7D9029">getState</span><span style="color: #666666">());</span>
            sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERINFO<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> data<span style="color: #666666">);</span>
            <span style="color: #408080; font-style: italic">// request for next order info</span>
            agent<span style="color: #666666">.</span><span style="color: #7D9029">wantOrderInfo</span><span style="color: #666666">();</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onOrderInfoEnd</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERINFO<span style="color: #666666">,</span> RESULT_ITEM_END<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onTreasureListFound</span><span style="color: #666666">(</span>String<span style="color: #666666">[]</span> treasures<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Count&quot;</span><span style="color: #666666">,</span> treasures<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE_LIST<span style="color: #666666">,</span> RESULT_ITEM_BEGIN<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>String t <span style="color: #666666">:</span> treasures<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            String<span style="color: #666666">[]</span> kv <span style="color: #666666">=</span> t<span style="color: #666666">.</span><span style="color: #7D9029">split</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;=&quot;</span><span style="color: #666666">);</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>kv<span style="color: #666666">.</span><span style="color: #7D9029">length</span> <span style="color: #666666">==</span> <span style="color: #666666">2)</span> <span style="color: #666666">{</span>
                jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Name&quot;</span><span style="color: #666666">,</span> kv<span style="color: #666666">[0]);</span>
                SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Value&quot;</span><span style="color: #666666">,</span> Integer<span style="color: #666666">.</span><span style="color: #7D9029">parseInt</span><span style="color: #666666">(</span>kv<span style="color: #666666">[1]));</span>
                sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE_LIST<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE_LIST<span style="color: #666666">,</span> RESULT_ITEM_END<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onTreasureChange</span><span style="color: #666666">(</span>String name<span style="color: #666666">,</span> <span style="color: #B00040">int</span> value<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Name&quot;</span><span style="color: #666666">,</span> name<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Value&quot;</span><span style="color: #666666">,</span> value<span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onLogValue</span><span style="color: #666666">(</span>String key<span style="color: #666666">,</span> <span style="color: #B00040">int</span> value<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Key&quot;</span><span style="color: #666666">,</span> key<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Value&quot;</span><span style="color: #666666">,</span> value<span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onExtMethodNotification</span><span style="color: #666666">(</span>String cookie<span style="color: #666666">,</span> <span style="color: #B00040">int</span> code<span style="color: #666666">,</span> String msg<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Cookie&quot;</span><span style="color: #666666">,</span> cookie<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Code&quot;</span><span style="color: #666666">,</span> code<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>msg <span style="color: #666666">!=</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span>
            SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Message&quot;</span><span style="color: #666666">,</span> msg<span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_EXTMETHOD<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onOrderStateChange</span><span style="color: #666666">(</span>String productID<span style="color: #666666">,</span> <span style="color: #B00040">int</span> num<span style="color: #666666">,</span> String orderID<span style="color: #666666">,</span> String state<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ProductID&quot;</span><span style="color: #666666">,</span> productID<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Num&quot;</span><span style="color: #666666">,</span> num<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;OrderID&quot;</span><span style="color: #666666">,</span> orderID<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;State&quot;</span><span style="color: #666666">,</span> state<span style="color: #666666">);</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERSTATE<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">onStateChange</span><span style="color: #666666">(</span><span style="color: #B00040">int</span> type<span style="color: #666666">,</span> <span style="color: #B00040">int</span> orgState<span style="color: #666666">,</span> <span style="color: #B00040">int</span> newState<span style="color: #666666">,</span> <span style="color: #B00040">int</span> reason<span style="color: #666666">,</span> <span style="color: #B00040">int</span> op<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        onLog<span style="color: #666666">(</span><span style="color: #BA2121">&quot;State change: &quot;</span> <span style="color: #666666">+</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getStateName</span><span style="color: #666666">(</span>type<span style="color: #666666">,</span> orgState<span style="color: #666666">)</span> <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; -&gt; &quot;</span> <span style="color: #666666">+</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getStateName</span><span style="color: #666666">(</span>type<span style="color: #666666">,</span> newState<span style="color: #666666">)</span> <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; # &quot;</span> <span style="color: #666666">+</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getStateChangeReasonName</span><span style="color: #666666">(</span>reason<span style="color: #666666">)</span> <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;\n&quot;</span><span style="color: #666666">);</span>
        JSONObject jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Type&quot;</span><span style="color: #666666">,</span> type<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;TypeName&quot;</span><span style="color: #666666">,</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getStateTypeName</span><span style="color: #666666">(</span>type<span style="color: #666666">));</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;OrgState&quot;</span><span style="color: #666666">,</span> orgState<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;OrgStateName&quot;</span><span style="color: #666666">,</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getStateName</span><span style="color: #666666">(</span>type<span style="color: #666666">,</span> orgState<span style="color: #666666">));</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;NewState&quot;</span><span style="color: #666666">,</span> newState<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;NewStateName&quot;</span><span style="color: #666666">,</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getStateName</span><span style="color: #666666">(</span>type<span style="color: #666666">,</span> newState<span style="color: #666666">));</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Reason&quot;</span><span style="color: #666666">,</span> reason<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;ReasonName&quot;</span><span style="color: #666666">,</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getStateChangeReasonName</span><span style="color: #666666">(</span>reason<span style="color: #666666">));</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectInt</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;Op&quot;</span><span style="color: #666666">,</span> op<span style="color: #666666">);</span>
        SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;OpName&quot;</span><span style="color: #666666">,</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getOpName</span><span style="color: #666666">(</span>op<span style="color: #666666">));</span>
        sendCallback<span style="color: #666666">(</span>CALLBACK_STATE<span style="color: #666666">,</span> RESULT_ITEM<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
        <span style="color: #008000; font-weight: bold">switch</span> <span style="color: #666666">(</span>op<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_INIT</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">!=</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">USRSTATE_INITIALIZING</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    agentInitialized <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">;</span>
                    agentInitializationResult <span style="color: #666666">=</span> reason<span style="color: #666666">;</span>
                    initUnityLib<span style="color: #666666">();</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_LOGIN</span><span style="color: #666666">:</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_AUTH</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">USRSTATE_INITIALIZED</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_LOGIN<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_LOGINGAME</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">USRSTATE_INITIALIZED</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_LOGIN<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">USRSTATE_LOGINEDGAME</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    String token <span style="color: #666666">=</span> agent<span style="color: #666666">.</span><span style="color: #7D9029">getSession</span><span style="color: #666666">().</span><span style="color: #7D9029">getRecoverToken</span><span style="color: #666666">();</span>
                    jo <span style="color: #666666">=</span> SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">createJSONObject</span><span style="color: #666666">();</span>
                    SGJsonUtil<span style="color: #666666">.</span><span style="color: #7D9029">putJSONObjectString</span><span style="color: #666666">(</span>jo<span style="color: #666666">,</span> <span style="color: #BA2121">&quot;RecoverToken&quot;</span><span style="color: #666666">,</span> token<span style="color: #666666">);</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_LOGIN<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">,</span> jo<span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_LOGOUTGAME</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">USRSTATE_LOGINEDGAME</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_LOGOUT<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_LOGOUT</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">USRSTATE_INITIALIZED</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_LOGOUT<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_GETORDER</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">PAYSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_PAY<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_PAY</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">PAYSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_PAY<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_CANCELED</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_PAY<span style="color: #666666">,</span> RESULT_CANCELLED<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_PAY<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">PAYSTATE_PAID</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    sendCallback<span style="color: #666666">(</span>CALLBACK_PAY<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">);</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_GETPRODUCTS</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">JOBSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_PRODUCT<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_GETORDERINFOLIST</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">JOBSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_ORDERINFO<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_GETTREASURELIST</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">JOBSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE_LIST<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_INCTREASURE</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">JOBSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_TREASURE<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_GETLOGVALUE</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">JOBSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_FAILURE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_REMOTE_LOG_VALUE<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_STARTGAME</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">JOBSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_START_GAME<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_START_GAME<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #008000; font-weight: bold">case</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">OP_STOPGAME</span><span style="color: #666666">:</span>
                <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>newState <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">JOBSTATE_IDLE</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>reason <span style="color: #666666">==</span> SGAgent<span style="color: #666666">.</span><span style="color: #7D9029">STATE_CHANGE_REASON_OP_SUCCESS</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_STOP_GAME<span style="color: #666666">,</span> RESULT_OK<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
                        sendCallback<span style="color: #666666">(</span>CALLBACK_STOP_GAME<span style="color: #666666">,</span> RESULT_FAIL<span style="color: #666666">);</span>
                    <span style="color: #666666">}</span>
                <span style="color: #666666">}</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

<span style="color: #666666">}</span>
</pre></div>

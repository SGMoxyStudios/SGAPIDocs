<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">package</span> com<span style="color: #333333">.</span><span style="color: #0000CC">sg</span><span style="color: #333333">.</span><span style="color: #0000CC">sgutiltest</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">java.text.SimpleDateFormat</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">java.util.ArrayList</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">java.util.Date</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">java.util.List</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">java.util.TimeZone</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.graphics.Color</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.os.Bundle</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.os.Handler</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.text.Layout</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.text.TextUtils</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.text.method.ScrollingMovementMethod</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.util.Log</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.view.LayoutInflater</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.view.View</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.view.ViewGroup</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.widget.AdapterView</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.widget.BaseAdapter</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.widget.Button</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.widget.ListView</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">android.widget.TextView</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">com.sg.util.SGActivity</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">com.sg.util.SGAgent</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">com.sg.util.SGGameServerDemo</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">com.sg.util.UOrder</span><span style="color: #333333">;</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">com.sg.util.UProduct</span><span style="color: #333333">;</span>

<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">static</span> android<span style="color: #333333">.</span><span style="color: #0000CC">view</span><span style="color: #333333">.</span><span style="color: #0000CC">View</span><span style="color: #333333">.</span><span style="color: #0000CC">TEXT_ALIGNMENT_CENTER</span><span style="color: #333333">;</span>

<span style="color: #888888">/**</span>
<span style="color: #888888"> * SGTutorialActivity is a main activity that extends SGActivity to utilize its</span>
<span style="color: #888888"> * lifecycle callback forwarding. SGActivity has a protected field &#39;agent&#39;, which</span>
<span style="color: #888888"> * is an instance of SGAgent.</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * The activity has following content view layout.</span>
<span style="color: #888888"> *</span>
<span style="color: #888888"> * +-----------------------------------+</span>
<span style="color: #888888"> * |                                   |</span>
<span style="color: #888888"> * | product list view                 |</span>
<span style="color: #888888"> * |                                   |</span>
<span style="color: #888888"> * +-----------------------------------+</span>
<span style="color: #888888"> * | btnUsr | btnJob | btnPay | btnExt |</span>
<span style="color: #888888"> * +-----------------------------------+</span>
<span style="color: #888888"> * |                                   |</span>
<span style="color: #888888"> * | log view                          |</span>
<span style="color: #888888"> * |                                   |</span>
<span style="color: #888888"> * +-----------------------------------+</span>
<span style="color: #888888"> */</span>
<span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">SGTutorialActivity</span> <span style="color: #008800; font-weight: bold">extends</span> SGActivity <span style="color: #333333">{</span>

	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">XProduct</span> <span style="color: #333333">{</span>
		UProduct product<span style="color: #333333">;</span>
		String orderID<span style="color: #333333">;</span>
		String state<span style="color: #333333">;</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">XOrder</span> <span style="color: #333333">{</span>
		String orderID<span style="color: #333333">;</span>
		String productID<span style="color: #333333">;</span>
		String productName<span style="color: #333333">;</span>
		<span style="color: #333399; font-weight: bold">int</span> buyNum<span style="color: #333333">;</span>
		String state<span style="color: #333333">;</span>
		String time<span style="color: #333333">;</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">private</span> Handler mHandler <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Handler<span style="color: #333333">();</span>

    <span style="color: #888888">// an list adapter to manage products</span>
    <span style="color: #008800; font-weight: bold">private</span> ProductListAdapter mProductListAdapter<span style="color: #333333">;</span>
    <span style="color: #888888">// an list adapter to manage orders</span>
	<span style="color: #008800; font-weight: bold">private</span> OrderListAdapter mOrderListAdapter<span style="color: #333333">;</span>
    <span style="color: #888888">// button for login/logout</span>
    <span style="color: #008800; font-weight: bold">private</span> Button mBtnUsr<span style="color: #333333">;</span>
    <span style="color: #888888">// button for get product list</span>
    <span style="color: #008800; font-weight: bold">private</span> Button mBtnJob<span style="color: #333333">;</span>
    <span style="color: #888888">// button for purchasing product</span>
    <span style="color: #008800; font-weight: bold">private</span> Button mBtnPay<span style="color: #333333">;</span>
    <span style="color: #888888">// button for exit program</span>
    <span style="color: #008800; font-weight: bold">private</span> Button mBtnExt<span style="color: #333333">;</span>

    <span style="color: #888888">// enable/disable buttons, change button captions according to latest states</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">updateButtons</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>

        <span style="color: #333399; font-weight: bold">int</span> usrState <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getUsrState</span><span style="color: #333333">();</span>
        <span style="color: #333399; font-weight: bold">int</span> payState <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getPayState</span><span style="color: #333333">();</span>
        <span style="color: #333399; font-weight: bold">int</span> jobState <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getJobState</span><span style="color: #333333">();</span>

		<span style="color: #888888">/* mBtnUsr */</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>usrState <span style="color: #333333">&lt;</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_LOGINEDGAME</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
            setButtonText<span style="color: #333333">(</span>mBtnUsr<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_login</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
            setButtonText<span style="color: #333333">(</span>mBtnUsr<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_logout</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">((</span>usrState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_INITIALIZED</span> <span style="color: #333333">||</span> usrState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_LOGINEDGAME</span><span style="color: #333333">)</span> <span style="color: #333333">&amp;&amp;</span> jobState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span> <span style="color: #333333">&amp;&amp;</span> payState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">PAYSTATE_IDLE</span> <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">(</span>usrState <span style="color: #333333">&lt;</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_LOGINEDGAME</span> <span style="color: #333333">||</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">isLogoutSupported</span><span style="color: #333333">()))</span>
            mBtnUsr<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">else</span>
            mBtnUsr<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">);</span>

        <span style="color: #333399; font-weight: bold">boolean</span> idle <span style="color: #333333">=</span> usrState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_LOGINEDGAME</span> <span style="color: #333333">&amp;&amp;</span> jobState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span> <span style="color: #333333">&amp;&amp;</span> payState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">PAYSTATE_IDLE</span><span style="color: #333333">;</span>

		<span style="color: #888888">/* mBtnJob */</span>
		<span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">getCount</span><span style="color: #333333">()</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
            setButtonText<span style="color: #333333">(</span>mBtnJob<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_products</span><span style="color: #333333">);</span>
			mBtnJob<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span>idle<span style="color: #333333">);</span>
		<span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
			setButtonText<span style="color: #333333">(</span>mBtnJob<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_orders</span><span style="color: #333333">);</span>
			mBtnJob<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span>idle<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>

		<span style="color: #888888">/* mBtnPay */</span>
		XProduct p <span style="color: #333333">=</span> mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">getHighlightProduct</span><span style="color: #333333">();</span>
		String state <span style="color: #333333">=</span> p <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">?</span> <span style="background-color: #fff0f0">&quot;&quot;</span> <span style="color: #333333">:</span> p<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>state<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
            setButtonText<span style="color: #333333">(</span>mBtnPay<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_oops</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>state<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;delivered&quot;</span><span style="color: #333333">)</span> <span style="color: #333333">||</span> state<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;succeeded&quot;</span><span style="color: #333333">)</span> <span style="color: #333333">||</span> state<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;cheated&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
            setButtonText<span style="color: #333333">(</span>mBtnPay<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_info</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>state<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;accepted&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
            setButtonText<span style="color: #333333">(</span>mBtnPay<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_check</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
            setButtonText<span style="color: #333333">(</span>mBtnPay<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_buy</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span>
        mBtnPay<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span>idle <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">!</span>state<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;&quot;</span><span style="color: #333333">));</span>

		<span style="color: #888888">/* mBtnExt */</span>
        setButtonText<span style="color: #333333">(</span>mBtnExt<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_exit</span><span style="color: #333333">);</span>
        mBtnExt<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span>idle <span style="color: #333333">||</span> usrState <span style="color: #333333">&lt;=</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_INITIALIZED</span><span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">// internal class to hold product information and views</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">ProductViewHolder</span> <span style="color: #333333">{</span>
        TextView name<span style="color: #333333">;</span>          <span style="color: #888888">// TextView to show product name</span>
        TextView price<span style="color: #333333">;</span>         <span style="color: #888888">// TextView to product price</span>
        TextView value<span style="color: #333333">;</span>         <span style="color: #888888">// TextView to product value</span>
        TextView state<span style="color: #333333">;</span>         <span style="color: #888888">// TextView to product state</span>
        XProduct productRef<span style="color: #333333">;</span>    <span style="color: #888888">// product information</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">// list adapter to manage products</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">ProductListAdapter</span> <span style="color: #008800; font-weight: bold">extends</span> BaseAdapter <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">private</span> LayoutInflater mInflator<span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">private</span> List<span style="color: #333333">&lt;</span>XProduct<span style="color: #333333">&gt;</span> mList<span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">private</span> XProduct mHighlightProduct<span style="color: #333333">;</span> <span style="color: #888888">// highlighted product (current, active)</span>

        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">ProductListAdapter</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">();</span>
            <span style="color: #888888">// initialize list to empty</span>
            mInflator <span style="color: #333333">=</span> SGTutorialActivity<span style="color: #333333">.</span><span style="color: #0000CC">this</span><span style="color: #333333">.</span><span style="color: #0000CC">getLayoutInflater</span><span style="color: #333333">();</span>
            mList <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> ArrayList<span style="color: #333333">&lt;</span>XProduct<span style="color: #333333">&gt;();</span>
            mHighlightProduct <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
        <span style="color: #333333">}</span>

        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">addProduct</span><span style="color: #333333">(</span>XProduct product<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(!</span>mList<span style="color: #333333">.</span><span style="color: #0000CC">contains</span><span style="color: #333333">(</span>product<span style="color: #333333">))</span> <span style="color: #333333">{</span>
                mList<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">(</span>product<span style="color: #333333">);</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>mHighlightProduct <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span>
                    mHighlightProduct <span style="color: #333333">=</span> product<span style="color: #333333">;</span>
                <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
        <span style="color: #333333">}</span>

        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">changeProductState</span><span style="color: #333333">(</span>String productID<span style="color: #333333">,</span> String orderID<span style="color: #333333">,</span> String state<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i<span style="color: #333333">&lt;</span>mList<span style="color: #333333">.</span><span style="color: #0000CC">size</span><span style="color: #333333">();</span> i<span style="color: #333333">++)</span> <span style="color: #333333">{</span>
                XProduct xp <span style="color: #333333">=</span> <span style="color: #333333">(</span>XProduct<span style="color: #333333">)</span>mList<span style="color: #333333">.</span><span style="color: #0000CC">get</span><span style="color: #333333">(</span>i<span style="color: #333333">);</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(!</span>xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getProductID</span><span style="color: #333333">().</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span>productID<span style="color: #333333">))</span>
                    <span style="color: #008800; font-weight: bold">continue</span><span style="color: #333333">;</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>xp<span style="color: #333333">.</span><span style="color: #0000CC">orderID</span> <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">!</span>xp<span style="color: #333333">.</span><span style="color: #0000CC">orderID</span><span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span>orderID<span style="color: #333333">))</span>
                    <span style="color: #008800; font-weight: bold">continue</span><span style="color: #333333">;</span>
                xp<span style="color: #333333">.</span><span style="color: #0000CC">orderID</span> <span style="color: #333333">=</span> orderID<span style="color: #333333">;</span>
                xp<span style="color: #333333">.</span><span style="color: #0000CC">state</span> <span style="color: #333333">=</span> state<span style="color: #333333">;</span>
                notifyDataSetChanged<span style="color: #333333">();</span>
                <span style="color: #008800; font-weight: bold">break</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>

        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">clear</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            mList<span style="color: #333333">.</span><span style="color: #0000CC">clear</span><span style="color: #333333">();</span>
            mHighlightProduct <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
        <span style="color: #333333">}</span>

		<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">setHighlightProduct</span><span style="color: #333333">(</span>XProduct product<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>mHighlightProduct <span style="color: #333333">!=</span> product<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                mHighlightProduct <span style="color: #333333">=</span> product<span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>

		<span style="color: #008800; font-weight: bold">public</span> XProduct <span style="color: #0066BB; font-weight: bold">getHighlightProduct</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">return</span> mHighlightProduct<span style="color: #333333">;</span>
        <span style="color: #333333">}</span>

        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">int</span> <span style="color: #0066BB; font-weight: bold">getCount</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">return</span> mList<span style="color: #333333">.</span><span style="color: #0000CC">size</span><span style="color: #333333">();</span>
        <span style="color: #333333">}</span>

        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">long</span> <span style="color: #0066BB; font-weight: bold">getItemId</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">return</span> i<span style="color: #333333">;</span>
        <span style="color: #333333">}</span>

        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> Object <span style="color: #0066BB; font-weight: bold">getItem</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">return</span> mList<span style="color: #333333">.</span><span style="color: #0000CC">get</span><span style="color: #333333">(</span>i<span style="color: #333333">);</span>
        <span style="color: #333333">}</span>

        <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">setTextViewHighlight</span><span style="color: #333333">(</span>TextView <span style="color: #333333">...</span> views<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> views<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">;</span>
            <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i<span style="color: #333333">&lt;</span>n<span style="color: #333333">;</span> i<span style="color: #333333">++)</span> <span style="color: #333333">{</span>
                views<span style="color: #333333">[</span>i<span style="color: #333333">].</span><span style="color: #0000CC">setBackgroundColor</span><span style="color: #333333">(</span>Color<span style="color: #333333">.</span><span style="color: #0000CC">parseColor</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;#c0c080&quot;</span><span style="color: #333333">));</span>
                views<span style="color: #333333">[</span>i<span style="color: #333333">].</span><span style="color: #0000CC">setTextColor</span><span style="color: #333333">(</span>Color<span style="color: #333333">.</span><span style="color: #0000CC">parseColor</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;#ffffff&quot;</span><span style="color: #333333">));</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>

        <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">setTextViewNormal</span><span style="color: #333333">(</span>TextView <span style="color: #333333">...</span> views<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> views<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">;</span>
            <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i<span style="color: #333333">&lt;</span>n<span style="color: #333333">;</span> i<span style="color: #333333">++)</span> <span style="color: #333333">{</span>
                views<span style="color: #333333">[</span>i<span style="color: #333333">].</span><span style="color: #0000CC">setBackgroundColor</span><span style="color: #333333">(</span>Color<span style="color: #333333">.</span><span style="color: #0000CC">parseColor</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;#70b040&quot;</span><span style="color: #333333">));</span>
                views<span style="color: #333333">[</span>i<span style="color: #333333">].</span><span style="color: #0000CC">setTextColor</span><span style="color: #333333">(</span>Color<span style="color: #333333">.</span><span style="color: #0000CC">parseColor</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;#000000&quot;</span><span style="color: #333333">));</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>

        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> View <span style="color: #0066BB; font-weight: bold">getView</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> idx<span style="color: #333333">,</span> View view<span style="color: #333333">,</span> ViewGroup viewGroup<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            ProductViewHolder vh<span style="color: #333333">;</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>view <span style="color: #333333">==</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                view <span style="color: #333333">=</span> mInflator<span style="color: #333333">.</span><span style="color: #0000CC">inflate</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">layout</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">);</span>
                vh <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> ProductViewHolder<span style="color: #333333">();</span>
                vh<span style="color: #333333">.</span><span style="color: #0000CC">name</span> <span style="color: #333333">=</span> <span style="color: #333333">(</span>TextView<span style="color: #333333">)</span>view<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_name</span><span style="color: #333333">);</span>
                vh<span style="color: #333333">.</span><span style="color: #0000CC">price</span> <span style="color: #333333">=</span> <span style="color: #333333">(</span>TextView<span style="color: #333333">)</span>view<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_price</span><span style="color: #333333">);</span>
                vh<span style="color: #333333">.</span><span style="color: #0000CC">value</span> <span style="color: #333333">=</span> <span style="color: #333333">(</span>TextView<span style="color: #333333">)</span>view<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_value</span><span style="color: #333333">);</span>
                vh<span style="color: #333333">.</span><span style="color: #0000CC">state</span> <span style="color: #333333">=</span> <span style="color: #333333">(</span>TextView<span style="color: #333333">)</span>view<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_state</span><span style="color: #333333">);</span>
                view<span style="color: #333333">.</span><span style="color: #0000CC">setTag</span><span style="color: #333333">(</span>vh<span style="color: #333333">);</span>
            <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
                vh <span style="color: #333333">=</span> <span style="color: #333333">(</span>ProductViewHolder<span style="color: #333333">)</span>view<span style="color: #333333">.</span><span style="color: #0000CC">getTag</span><span style="color: #333333">();</span>
            <span style="color: #333333">}</span>
            vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span> <span style="color: #333333">=</span> mList<span style="color: #333333">.</span><span style="color: #0000CC">get</span><span style="color: #333333">(</span>idx<span style="color: #333333">);</span>
			vh<span style="color: #333333">.</span><span style="color: #0000CC">name</span><span style="color: #333333">.</span><span style="color: #0000CC">setText</span><span style="color: #333333">(</span>vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span><span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getProductName</span><span style="color: #333333">());</span>
			vh<span style="color: #333333">.</span><span style="color: #0000CC">price</span><span style="color: #333333">.</span><span style="color: #0000CC">setText</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;&quot;</span> <span style="color: #333333">+</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span><span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getPrice</span><span style="color: #333333">());</span>
			vh<span style="color: #333333">.</span><span style="color: #0000CC">value</span><span style="color: #333333">.</span><span style="color: #0000CC">setText</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;&quot;</span> <span style="color: #333333">+</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span><span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getCoins</span><span style="color: #333333">());</span>
			vh<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">.</span><span style="color: #0000CC">setText</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;&quot;</span> <span style="color: #333333">+</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span><span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">);</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span> <span style="color: #333333">==</span> mHighlightProduct<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                setTextViewHighlight<span style="color: #333333">(</span>vh<span style="color: #333333">.</span><span style="color: #0000CC">name</span><span style="color: #333333">,</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">price</span><span style="color: #333333">,</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">value</span><span style="color: #333333">,</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">);</span>
            <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
                setTextViewNormal<span style="color: #333333">(</span>vh<span style="color: #333333">.</span><span style="color: #0000CC">name</span><span style="color: #333333">,</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">price</span><span style="color: #333333">,</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">value</span><span style="color: #333333">,</span> vh<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">);</span>
            <span style="color: #333333">}</span>
            <span style="color: #008800; font-weight: bold">return</span> view<span style="color: #333333">;</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">// list adapter to manage orders</span>
	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">OrderListAdapter</span> <span style="color: #008800; font-weight: bold">extends</span> BaseAdapter <span style="color: #333333">{</span>

		<span style="color: #008800; font-weight: bold">private</span> List<span style="color: #333333">&lt;</span>XOrder<span style="color: #333333">&gt;</span> mList<span style="color: #333333">;</span>

		<span style="color: #008800; font-weight: bold">public</span> <span style="color: #0066BB; font-weight: bold">OrderListAdapter</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">super</span><span style="color: #333333">();</span>
			mList <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> ArrayList<span style="color: #333333">&lt;</span>XOrder<span style="color: #333333">&gt;();</span>
		<span style="color: #333333">}</span>

		<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">addOrder</span><span style="color: #333333">(</span>XOrder order<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			mList<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">(</span>order<span style="color: #333333">);</span>
			<span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
		<span style="color: #333333">}</span>

		<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">clear</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
			mList<span style="color: #333333">.</span><span style="color: #0000CC">clear</span><span style="color: #333333">();</span>
		<span style="color: #333333">}</span>

		<span style="color: #555555; font-weight: bold">@Override</span>
		<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">int</span> <span style="color: #0066BB; font-weight: bold">getCount</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">return</span> mList<span style="color: #333333">.</span><span style="color: #0000CC">size</span><span style="color: #333333">();</span>
		<span style="color: #333333">}</span>

		<span style="color: #555555; font-weight: bold">@Override</span>
		<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">long</span> <span style="color: #0066BB; font-weight: bold">getItemId</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">return</span> i<span style="color: #333333">;</span>
		<span style="color: #333333">}</span>

		<span style="color: #555555; font-weight: bold">@Override</span>
		<span style="color: #008800; font-weight: bold">public</span> Object <span style="color: #0066BB; font-weight: bold">getItem</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">return</span> mList<span style="color: #333333">.</span><span style="color: #0000CC">get</span><span style="color: #333333">(</span>i<span style="color: #333333">);</span>
		<span style="color: #333333">}</span>

		<span style="color: #555555; font-weight: bold">@Override</span>
		<span style="color: #008800; font-weight: bold">public</span> View <span style="color: #0066BB; font-weight: bold">getView</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> idx<span style="color: #333333">,</span> View view<span style="color: #333333">,</span> ViewGroup viewGroup<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			<span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">enableButtons</span><span style="color: #333333">(</span>Button <span style="color: #333333">...</span> btns<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span>Button btn <span style="color: #333333">:</span> btns<span style="color: #333333">)</span> <span style="color: #333333">{</span>
			btn<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">);</span>
		<span style="color: #333333">}</span>
	<span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">disableButtons</span><span style="color: #333333">(</span>Button <span style="color: #333333">...</span> btns<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span>Button btn <span style="color: #333333">:</span> btns<span style="color: #333333">)</span> <span style="color: #333333">{</span>
            btn<span style="color: #333333">.</span><span style="color: #0000CC">setEnabled</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">);</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">setTextViewText</span><span style="color: #333333">(</span>TextView tv<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> resid<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        tv<span style="color: #333333">.</span><span style="color: #0000CC">setText</span><span style="color: #333333">(</span>resid<span style="color: #333333">);</span>
        tv<span style="color: #333333">.</span><span style="color: #0000CC">setTextAlignment</span><span style="color: #333333">(</span>TEXT_ALIGNMENT_CENTER<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">setButtonText</span><span style="color: #333333">(</span>Button btn<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> resid<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        btn<span style="color: #333333">.</span><span style="color: #0000CC">setTag</span><span style="color: #333333">(</span>resid<span style="color: #333333">);</span>
        btn<span style="color: #333333">.</span><span style="color: #0000CC">setText</span><span style="color: #333333">(</span>resid<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">/**</span>
<span style="color: #888888">     * Initialize UI of parent class SGActivity. This method should be called before agent.onCreate is called.</span>
<span style="color: #888888">     */</span>
    <span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">initializeUI</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
        setContentView<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">layout</span><span style="color: #333333">.</span><span style="color: #0000CC">main_activity</span><span style="color: #333333">);</span>

        <span style="color: #333333">((</span>TextView<span style="color: #333333">)</span>findViewById<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">main_logs</span><span style="color: #333333">)).</span><span style="color: #0000CC">setMovementMethod</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> ScrollingMovementMethod<span style="color: #333333">());</span>
        <span style="color: #888888">// find product list view</span>
        ListView v <span style="color: #333333">=</span> <span style="color: #333333">(</span>ListView<span style="color: #333333">)</span>findViewById<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">main_product_list</span><span style="color: #333333">);</span>
        <span style="color: #888888">// create a header bar</span>
        LayoutInflater inflater <span style="color: #333333">=</span> getLayoutInflater<span style="color: #333333">();</span>
        ViewGroup header <span style="color: #333333">=</span> <span style="color: #333333">(</span>ViewGroup<span style="color: #333333">)</span>inflater<span style="color: #333333">.</span><span style="color: #0000CC">inflate</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">layout</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item</span><span style="color: #333333">,</span> v<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">);</span>
        header<span style="color: #333333">.</span><span style="color: #0000CC">setBackgroundColor</span><span style="color: #333333">(</span>Color<span style="color: #333333">.</span><span style="color: #0000CC">parseColor</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;#f0c080&quot;</span><span style="color: #333333">));</span>
        <span style="color: #888888">// set names of columns shown in header bar</span>
        setTextViewText<span style="color: #333333">((</span>TextView<span style="color: #333333">)</span>header<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_name</span><span style="color: #333333">),</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_name_cap</span><span style="color: #333333">);</span>
        setTextViewText<span style="color: #333333">((</span>TextView<span style="color: #333333">)</span>header<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_price</span><span style="color: #333333">),</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_price_cap</span><span style="color: #333333">);</span>
        setTextViewText<span style="color: #333333">((</span>TextView<span style="color: #333333">)</span>header<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_value</span><span style="color: #333333">),</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_value_cap</span><span style="color: #333333">);</span>
        setTextViewText<span style="color: #333333">((</span>TextView<span style="color: #333333">)</span>header<span style="color: #333333">.</span><span style="color: #0000CC">findViewById</span><span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_state</span><span style="color: #333333">),</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">product_list_item_state_cap</span><span style="color: #333333">);</span>
        <span style="color: #888888">// add the header bar to the top of product list</span>
        v<span style="color: #333333">.</span><span style="color: #0000CC">addHeaderView</span><span style="color: #333333">(</span>header<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">);</span>
        <span style="color: #888888">// create list adapter</span>
        mProductListAdapter <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> ProductListAdapter<span style="color: #333333">();</span>
        v<span style="color: #333333">.</span><span style="color: #0000CC">setAdapter</span><span style="color: #333333">(</span>mProductListAdapter<span style="color: #333333">);</span>
        <span style="color: #888888">// set up click handler</span>
        v<span style="color: #333333">.</span><span style="color: #0000CC">setOnItemClickListener</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> AdapterView<span style="color: #333333">.</span><span style="color: #0000CC">OnItemClickListener</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onItemClick</span><span style="color: #333333">(</span>AdapterView<span style="color: #333333">&lt;?&gt;</span> parent<span style="color: #333333">,</span> View view<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> position<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">long</span> id<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #888888">// if agent is idle, highlight clicked product and update buttons according to its state</span>
                <span style="color: #333399; font-weight: bold">int</span> usrState <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getUsrState</span><span style="color: #333333">();</span>
                <span style="color: #333399; font-weight: bold">int</span> payState <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getPayState</span><span style="color: #333333">();</span>
                <span style="color: #333399; font-weight: bold">int</span> jobState <span style="color: #333333">=</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getJobState</span><span style="color: #333333">();</span>
                <span style="color: #333399; font-weight: bold">boolean</span> idle <span style="color: #333333">=</span> usrState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">USRSTATE_LOGINEDGAME</span> <span style="color: #333333">&amp;&amp;</span> jobState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">JOBSTATE_IDLE</span> <span style="color: #333333">&amp;&amp;</span> payState <span style="color: #333333">==</span> SGAgent<span style="color: #333333">.</span><span style="color: #0000CC">PAYSTATE_IDLE</span><span style="color: #333333">;</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>idle<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    ProductViewHolder vh <span style="color: #333333">=</span> <span style="color: #333333">(</span>ProductViewHolder<span style="color: #333333">)</span> view<span style="color: #333333">.</span><span style="color: #0000CC">getTag</span><span style="color: #333333">();</span>
                    <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span> <span style="color: #333333">!=</span> mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">getHighlightProduct</span><span style="color: #333333">())</span> <span style="color: #333333">{</span>
                        <span style="color: #888888">// highlight product if not highlighted</span>
                        mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">setHighlightProduct</span><span style="color: #333333">(</span>vh<span style="color: #333333">.</span><span style="color: #0000CC">productRef</span><span style="color: #333333">);</span>
                        <span style="color: #888888">// and show in highlighted color</span>
                        mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">notifyDataSetChanged</span><span style="color: #333333">();</span>
                        <span style="color: #888888">// and update buttons</span>
                        updateButtons<span style="color: #333333">();</span>
                    <span style="color: #333333">}</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">});</span>

        mBtnUsr <span style="color: #333333">=</span> <span style="color: #333333">(</span>Button<span style="color: #333333">)</span>findViewById<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">main_btn_usr</span><span style="color: #333333">);</span>
        mBtnJob <span style="color: #333333">=</span> <span style="color: #333333">(</span>Button<span style="color: #333333">)</span>findViewById<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">main_btn_job</span><span style="color: #333333">);</span>
        mBtnPay <span style="color: #333333">=</span> <span style="color: #333333">(</span>Button<span style="color: #333333">)</span>findViewById<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">main_btn_pay</span><span style="color: #333333">);</span>
        mBtnExt <span style="color: #333333">=</span> <span style="color: #333333">(</span>Button<span style="color: #333333">)</span>findViewById<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">main_btn_exit</span><span style="color: #333333">);</span>

        <span style="color: #888888">// disable job button and purchase button as user is not logined yet</span>
        disableButtons<span style="color: #333333">(</span>mBtnJob<span style="color: #333333">,</span> mBtnPay<span style="color: #333333">);</span>

        <span style="color: #888888">// initialize button captions and set up click handler</span>
        setButtonText<span style="color: #333333">(</span>mBtnUsr<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_login</span><span style="color: #333333">);</span>
        mBtnUsr<span style="color: #333333">.</span><span style="color: #0000CC">setOnClickListener</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> View<span style="color: #333333">.</span><span style="color: #0000CC">OnClickListener</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onClick</span><span style="color: #333333">(</span>View v<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">int</span> tag <span style="color: #333333">=</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span>v<span style="color: #333333">.</span><span style="color: #0000CC">getTag</span><span style="color: #333333">();</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>tag <span style="color: #333333">==</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_login</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    agent<span style="color: #333333">.</span><span style="color: #0000CC">login</span><span style="color: #333333">();</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>tag <span style="color: #333333">==</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_logout</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    agent<span style="color: #333333">.</span><span style="color: #0000CC">logout</span><span style="color: #333333">();</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">});</span>
        setButtonText<span style="color: #333333">(</span>mBtnJob<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_products</span><span style="color: #333333">);</span>
        mBtnJob<span style="color: #333333">.</span><span style="color: #0000CC">setOnClickListener</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> View<span style="color: #333333">.</span><span style="color: #0000CC">OnClickListener</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onClick</span><span style="color: #333333">(</span>View v<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">int</span> tag <span style="color: #333333">=</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span>v<span style="color: #333333">.</span><span style="color: #0000CC">getTag</span><span style="color: #333333">();</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>tag <span style="color: #333333">==</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_products</span><span style="color: #333333">)</span>
                    agent<span style="color: #333333">.</span><span style="color: #0000CC">getProducts</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">);</span>
                <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066BB; font-weight: bold">if</span> <span style="color: #333333">(</span>tag <span style="color: #333333">==</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_orders</span><span style="color: #333333">)</span>
					agent<span style="color: #333333">.</span><span style="color: #0000CC">getOrderInfoList</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">);</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">});</span>
        setButtonText<span style="color: #333333">(</span>mBtnPay<span style="color: #333333">,</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_buy</span><span style="color: #333333">);</span>
        mBtnPay<span style="color: #333333">.</span><span style="color: #0000CC">setOnClickListener</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> View<span style="color: #333333">.</span><span style="color: #0000CC">OnClickListener</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onClick</span><span style="color: #333333">(</span>View v<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">int</span> tag <span style="color: #333333">=</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span>v<span style="color: #333333">.</span><span style="color: #0000CC">getTag</span><span style="color: #333333">();</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>tag <span style="color: #333333">==</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_buy</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					agent<span style="color: #333333">.</span><span style="color: #0000CC">buyProduct</span><span style="color: #333333">(</span>mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">getHighlightProduct</span><span style="color: #333333">().</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getProductID</span><span style="color: #333333">(),</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;coin&quot;</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>tag <span style="color: #333333">==</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_check</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					agent<span style="color: #333333">.</span><span style="color: #0000CC">getOrderState</span><span style="color: #333333">(</span>mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">getHighlightProduct</span><span style="color: #333333">().</span><span style="color: #0000CC">orderID</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>tag <span style="color: #333333">==</span> R<span style="color: #333333">.</span><span style="color: #0000CC">string</span><span style="color: #333333">.</span><span style="color: #0000CC">btn_main_info</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
					dumpProductInfo<span style="color: #333333">();</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #333333">{</span>
                    <span style="color: #333333">;</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">});</span>
        mBtnExt<span style="color: #333333">.</span><span style="color: #0000CC">setOnClickListener</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> View<span style="color: #333333">.</span><span style="color: #0000CC">OnClickListener</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onClick</span><span style="color: #333333">(</span>View v<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                agent<span style="color: #333333">.</span><span style="color: #0000CC">exit</span><span style="color: #333333">();</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">});</span>
	<span style="color: #333333">}</span>

	<span style="color: #008800; font-weight: bold">private</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">dumpProductInfo</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
		XProduct xp <span style="color: #333333">=</span> mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">getHighlightProduct</span><span style="color: #333333">();</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;productInfo = {\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    productID: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getProductID</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    productName: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getProductName</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    productDesc: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getProductDesc</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    roleID: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getRoleID</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    roleName: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getRoleName</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    roleLevel: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getRoleLevel</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    serverID: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getServerID</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    price: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getPrice</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    coins: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getCoins</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    appID: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getAppID</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    appName: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span><span style="color: #333333">.</span><span style="color: #0000CC">getAppName</span><span style="color: #333333">(),</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    orderID: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">orderID</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;,\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;    state: &quot;</span> <span style="color: #333333">+</span> xp<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;\n&quot;</span><span style="color: #333333">);</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;}\n&quot;</span><span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">/**</span>
<span style="color: #888888">     * Override onPreInitialization to do something before initialization (SGAgent.onCreate).</span>
<span style="color: #888888">     */</span>
    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onPreInitialization</span><span style="color: #333333">(</span>Bundle savedInstanceState<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        initializeUI<span style="color: #333333">();</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">/**</span>
<span style="color: #888888">     * Override onPostInitialization to do more jobs than SGActivity.</span>
<span style="color: #888888">     */</span>
    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onPostInitialization</span><span style="color: #333333">(</span>Bundle savedInstanceState<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// Set order state checking intervals to null to disable auto state query after payment UI</span>
        <span style="color: #888888">// operation is completed. That is, you need to click purchase button (caption changed to</span>
        <span style="color: #888888">// &quot;Check&quot; in this case) to query the order state manually.</span>
        agent<span style="color: #333333">.</span><span style="color: #0000CC">setOrderStateCheckingIntervals</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">);</span>
        <span style="color: #888888">// You need to set instance of your own game server - which implements SGGameServerInterface.</span>
	    <span style="color: #888888">// class YourGameServer implements SGGameServerInterface {</span>
	    <span style="color: #888888">// }</span>
        <span style="color: #888888">// agent.setGameServer(new YourGameServer(), params);</span>
	    <span style="color: #888888">// A game server instance must be set otherwise the login process does not start.</span>
	    agent<span style="color: #333333">.</span><span style="color: #0000CC">setGameServer</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> SGGameServerDemo<span style="color: #333333">(),</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">// SGUtil may print visual logs via this method.</span>
    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onLog</span><span style="color: #333333">(</span>String text<span style="color: #333333">)</span> <span style="color: #333333">{</span>

        TextView logView <span style="color: #333333">=</span> <span style="color: #333333">(</span>TextView<span style="color: #333333">)</span>findViewById<span style="color: #333333">(</span>R<span style="color: #333333">.</span><span style="color: #0000CC">id</span><span style="color: #333333">.</span><span style="color: #0000CC">main_logs</span><span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>logView <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(!</span>text<span style="color: #333333">.</span><span style="color: #0000CC">endsWith</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;\n&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
                text <span style="color: #333333">+=</span> <span style="background-color: #fff0f0">&quot;\n&quot;</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
            logView<span style="color: #333333">.</span><span style="color: #0000CC">append</span><span style="color: #333333">(</span>text<span style="color: #333333">);</span>
            Layout layout <span style="color: #333333">=</span> logView<span style="color: #333333">.</span><span style="color: #0000CC">getLayout</span><span style="color: #333333">();</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>layout <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> logView<span style="color: #333333">.</span><span style="color: #0000CC">getLineCount</span><span style="color: #333333">();</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>n <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    <span style="color: #333399; font-weight: bold">int</span> bottom <span style="color: #333333">=</span> layout<span style="color: #333333">.</span><span style="color: #0000CC">getLineBottom</span><span style="color: #333333">(</span>n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">);</span>
                    <span style="color: #333399; font-weight: bold">int</span> top <span style="color: #333333">=</span> logView<span style="color: #333333">.</span><span style="color: #0000CC">getScrollY</span><span style="color: #333333">();</span>
                    <span style="color: #333399; font-weight: bold">int</span> height <span style="color: #333333">=</span> logView<span style="color: #333333">.</span><span style="color: #0000CC">getHeight</span><span style="color: #333333">();</span>
                    <span style="color: #333399; font-weight: bold">int</span> delta <span style="color: #333333">=</span> <span style="color: #333333">(</span>bottom <span style="color: #333333">-</span> top<span style="color: #333333">)</span> <span style="color: #333333">-</span> height<span style="color: #333333">;</span>
                    <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>delta <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">)</span>
                        logView<span style="color: #333333">.</span><span style="color: #0000CC">scrollBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> delta<span style="color: #333333">);</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>

        Log<span style="color: #333333">.</span><span style="color: #0000CC">d</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;SGUtil&quot;</span><span style="color: #333333">,</span> text<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #888888">// SGUtil may print visual logs via this method.</span>
    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onLog</span><span style="color: #333333">(</span>String text<span style="color: #333333">,</span> String postfix<span style="color: #333333">)</span> <span style="color: #333333">{</span>
	    onLog<span style="color: #333333">(</span>text <span style="color: #333333">+</span> <span style="color: #333333">(</span>postfix <span style="color: #333333">!=</span> <span style="color: #008800; font-weight: bold">null</span> <span style="color: #333333">?</span> postfix <span style="color: #333333">:</span> <span style="background-color: #fff0f0">&quot;&quot;</span><span style="color: #333333">));</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">onProductBegin</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> num<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// clear product list view</span>
        mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">clear</span><span style="color: #333333">();</span>
        <span style="color: #888888">// return true to let SGUtil notify us product information right now</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onProductFound</span><span style="color: #333333">(</span>UProduct product<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// add new product</span>
		XProduct xp <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> XProduct<span style="color: #333333">();</span>
		xp<span style="color: #333333">.</span><span style="color: #0000CC">product</span> <span style="color: #333333">=</span> product<span style="color: #333333">;</span>
		xp<span style="color: #333333">.</span><span style="color: #0000CC">orderID</span> <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">null</span><span style="color: #333333">;</span>
		xp<span style="color: #333333">.</span><span style="color: #0000CC">state</span> <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;buyable&quot;</span><span style="color: #333333">;</span>
		mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">addProduct</span><span style="color: #333333">(</span>xp<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onProductEnd</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// all products notified, redraw product list view</span>
        mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">notifyDataSetChanged</span><span style="color: #333333">();</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">onOrderInfoBegin</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> num<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #888888">// clear order list view</span>
		mOrderListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">clear</span><span style="color: #333333">();</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;orderInfos = {\n&quot;</span><span style="color: #333333">);</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onOrderInfoFound</span><span style="color: #333333">(</span>UOrder order<span style="color: #333333">)</span> <span style="color: #333333">{</span>
		<span style="color: #888888">// add new order</span>
		XOrder xo <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> XOrder<span style="color: #333333">();</span>
		xo<span style="color: #333333">.</span><span style="color: #0000CC">orderID</span> <span style="color: #333333">=</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getOrderTicket</span><span style="color: #333333">().</span><span style="color: #0000CC">getOrderID</span><span style="color: #333333">();</span>
		xo<span style="color: #333333">.</span><span style="color: #0000CC">productID</span> <span style="color: #333333">=</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getProduct</span><span style="color: #333333">().</span><span style="color: #0000CC">getProductID</span><span style="color: #333333">();</span>
		xo<span style="color: #333333">.</span><span style="color: #0000CC">productName</span> <span style="color: #333333">=</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getProduct</span><span style="color: #333333">().</span><span style="color: #0000CC">getProductName</span><span style="color: #333333">();</span>
		xo<span style="color: #333333">.</span><span style="color: #0000CC">buyNum</span> <span style="color: #333333">=</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getPayParams</span><span style="color: #333333">().</span><span style="color: #0000CC">getBuyNum</span><span style="color: #333333">();</span>
		xo<span style="color: #333333">.</span><span style="color: #0000CC">state</span> <span style="color: #333333">=</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getState</span><span style="color: #333333">();</span>
		<span style="color: #333399; font-weight: bold">long</span> t <span style="color: #333333">=</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;delivered&quot;</span><span style="color: #333333">)</span> <span style="color: #333333">?</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getDeliveredTime</span><span style="color: #333333">()</span> <span style="color: #333333">:</span>
				<span style="color: #333333">(</span>xo<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;succeeded&quot;</span><span style="color: #333333">)</span> <span style="color: #333333">||</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;failed&quot;</span><span style="color: #333333">)</span> <span style="color: #333333">||</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">state</span><span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;cheated&quot;</span><span style="color: #333333">)</span> <span style="color: #333333">?</span> order<span style="color: #333333">.</span><span style="color: #0000CC">getCompletedTime</span><span style="color: #333333">()</span> <span style="color: #333333">:</span>
				 order<span style="color: #333333">.</span><span style="color: #0000CC">getGeneratedTime</span><span style="color: #333333">());</span>
		SimpleDateFormat sdf <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> SimpleDateFormat<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span style="color: #333333">);</span>
		sdf<span style="color: #333333">.</span><span style="color: #0000CC">setTimeZone</span><span style="color: #333333">(</span>TimeZone<span style="color: #333333">.</span><span style="color: #0000CC">getTimeZone</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;Asia/Shanghai&quot;</span><span style="color: #333333">));</span>
		xo<span style="color: #333333">.</span><span style="color: #0000CC">time</span> <span style="color: #333333">=</span> sdf<span style="color: #333333">.</span><span style="color: #0000CC">format</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Date<span style="color: #333333">(</span>t<span style="color: #333333">));</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;(&quot;</span> <span style="color: #333333">+</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">orderID</span> <span style="color: #333333">+</span>
			  <span style="background-color: #fff0f0">&quot;, &quot;</span> <span style="color: #333333">+</span> <span style="color: #333333">(</span>TextUtils<span style="color: #333333">.</span><span style="color: #0000CC">isEmpty</span><span style="color: #333333">(</span>xo<span style="color: #333333">.</span><span style="color: #0000CC">productName</span><span style="color: #333333">)</span> <span style="color: #333333">?</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">productID</span> <span style="color: #333333">:</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">productName</span><span style="color: #333333">)</span> <span style="color: #333333">+</span>
			  <span style="background-color: #fff0f0">&quot;, &quot;</span> <span style="color: #333333">+</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">buyNum</span> <span style="color: #333333">+</span>
			  <span style="background-color: #fff0f0">&quot;, &quot;</span> <span style="color: #333333">+</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">state</span> <span style="color: #333333">+</span>
			  <span style="background-color: #fff0f0">&quot;, &quot;</span> <span style="color: #333333">+</span> xo<span style="color: #333333">.</span><span style="color: #0000CC">time</span> <span style="color: #333333">+</span>
			  <span style="background-color: #fff0f0">&quot;)\n&quot;</span><span style="color: #333333">);</span>
		mOrderListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">addOrder</span><span style="color: #333333">(</span>xo<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onOrderInfoEnd</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// all orders notified</span>
	    onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;}\n&quot;</span><span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onTreasureListFound</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> treasures<span style="color: #333333">)</span> <span style="color: #333333">{</span>
    	<span style="color: #888888">// got list of treasures</span>
        <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span> i<span style="color: #333333">&lt;</span>treasures<span style="color: #333333">.</span><span style="color: #0000CC">length</span><span style="color: #333333">;</span> i<span style="color: #333333">++)</span>
	        onLog<span style="color: #333333">(</span>treasures<span style="color: #333333">[</span>i<span style="color: #333333">]);</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onTreasureChange</span><span style="color: #333333">(</span>String name<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> count<span style="color: #333333">)</span> <span style="color: #333333">{</span>
	    <span style="color: #888888">// count of treasure &#39;name&#39; updated</span>
	    onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;treasure: &quot;</span> <span style="color: #333333">+</span> name <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span> <span style="color: #333333">+</span> count<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onLogValue</span><span style="color: #333333">(</span>String key<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> value<span style="color: #333333">,</span> String msg<span style="color: #333333">)</span> <span style="color: #333333">{</span>
    	<span style="color: #888888">// got the value of log item &#39;key&#39;</span>
	    onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;log: &quot;</span> <span style="color: #333333">+</span> key <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; &quot;</span> <span style="color: #333333">+</span> value <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;, &quot;</span> <span style="color: #333333">+</span> msg<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

	<span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onExtMethodNotification</span><span style="color: #333333">(</span>String cookie<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> code<span style="color: #333333">,</span> String msg<span style="color: #333333">)</span> <span style="color: #333333">{</span>
    	<span style="color: #888888">// execution of certain extended command finished, result being notified</span>
		onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;cookie=&quot;</span> <span style="color: #333333">+</span> cookie <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;, code=&quot;</span> <span style="color: #333333">+</span> code <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;, msg=&quot;</span> <span style="color: #333333">+</span> msg<span style="color: #333333">);</span>
	<span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
	<span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onOrderStateChange</span><span style="color: #333333">(</span>String productID<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> num<span style="color: #333333">,</span> String orderID<span style="color: #333333">,</span> String state<span style="color: #333333">,</span> String message<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// update product view when its state changes</span>
		mProductListAdapter<span style="color: #333333">.</span><span style="color: #0000CC">changeProductState</span><span style="color: #333333">(</span>productID<span style="color: #333333">,</span> orderID<span style="color: #333333">,</span> state<span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onStateChange</span><span style="color: #333333">(</span><span style="color: #333399; font-weight: bold">int</span> type<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> orgState<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> newState<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> reason<span style="color: #333333">,</span> <span style="color: #333399; font-weight: bold">int</span> op<span style="color: #333333">,</span> String arg<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// A state changed. Update buttons</span>
        updateButtons<span style="color: #333333">();</span>
        <span style="color: #888888">// You may use passed parameters to judge what to do at present.</span>
	    onLog<span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;State change: &quot;</span> <span style="color: #333333">+</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateName</span><span style="color: #333333">(</span>type<span style="color: #333333">,</span> orgState<span style="color: #333333">)</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; -&gt; &quot;</span> <span style="color: #333333">+</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateName</span><span style="color: #333333">(</span>type<span style="color: #333333">,</span> newState<span style="color: #333333">)</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot; # &quot;</span> <span style="color: #333333">+</span> agent<span style="color: #333333">.</span><span style="color: #0000CC">getStateChangeReasonName</span><span style="color: #333333">(</span>reason<span style="color: #333333">)</span> <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;\n&quot;</span><span style="color: #333333">);</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onExitCancelled</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
        <span style="color: #888888">// recover screen and go on</span>
    <span style="color: #333333">}</span>

    <span style="color: #555555; font-weight: bold">@Override</span>
    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">onFuncRequest</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">final</span> String func<span style="color: #333333">,</span> <span style="color: #008800; font-weight: bold">final</span> String id<span style="color: #333333">,</span> String arg<span style="color: #333333">)</span> <span style="color: #333333">{</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>func<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;screenshot&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
            mHandler<span style="color: #333333">.</span><span style="color: #0000CC">post</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Runnable<span style="color: #333333">()</span> <span style="color: #333333">{</span>
                <span style="color: #555555; font-weight: bold">@Override</span>
                <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">run</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
                    <span style="color: #888888">// do nothing but failure notification</span>
                    agent<span style="color: #333333">.</span><span style="color: #0000CC">notifyFuncRequestResult</span><span style="color: #333333">(</span>func<span style="color: #333333">,</span> id<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;failed&quot;</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">});</span>
        <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>func<span style="color: #333333">.</span><span style="color: #0000CC">equals</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;logout&quot;</span><span style="color: #333333">))</span> <span style="color: #333333">{</span>
            mHandler<span style="color: #333333">.</span><span style="color: #0000CC">post</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Runnable<span style="color: #333333">()</span> <span style="color: #333333">{</span>
                <span style="color: #555555; font-weight: bold">@Override</span>
                <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">run</span><span style="color: #333333">()</span> <span style="color: #333333">{</span>
                    <span style="color: #888888">// raise logout request (asynchronous)</span>
                    agent<span style="color: #333333">.</span><span style="color: #0000CC">logout</span><span style="color: #333333">();</span>
                    <span style="color: #888888">// success notification</span>
                    agent<span style="color: #333333">.</span><span style="color: #0000CC">notifyFuncRequestResult</span><span style="color: #333333">(</span>func<span style="color: #333333">,</span> id<span style="color: #333333">,</span> <span style="background-color: #fff0f0">&quot;succeeded&quot;</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">});</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>

<span style="color: #333333">}</span>
</pre></div>
